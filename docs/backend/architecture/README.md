# 后端架构设计

本目录包含AI自动化测试平台后端项目的架构设计文档。

## 架构版本演进

### v4 极简架构 (推荐版本)
- **文档**: [v4-simplified.md](./v4-simplified.md)
- **特点**: 极简扁平化架构，专注快速开发
- **技术栈**: FastAPI + SQLite + Pydantic
- **设计理念**: KISS原则，最少抽象，最高效率
- **适用场景**: 小型项目、MVP开发、快速原型

### v2 分层架构 (简化版本)
- **文档**: [v2.md](./v2.md)
- **特点**: 简化的分层架构，适合中小型项目
- **技术栈**: FastAPI + SQLite + Pydantic
- **设计理念**: 在保持代码清晰的同时避免过度设计
- **适用场景**: 中小型项目、团队协作开发

### v3 DDD架构 (复杂版本)
- **文档**: [v3-ddd.md](./v3-ddd.md)
- **特点**: 领域驱动设计，适合大型复杂项目
- **技术栈**: FastAPI + SQLite + DDD模式
- **设计理念**: 高度模块化，严格的分层和依赖管理
- **适用场景**: 大型项目、复杂业务逻辑

## 架构选择指南

### 选择v4极简架构的场景 ⭐ 推荐
- **项目规模**: 小型项目 (< 5万行代码)
- **团队规模**: 1-3人
- **开发周期**: 短期快速开发
- **项目类型**: MVP、原型、个人项目
- **学习成本**: 极低，1天上手

### 选择v2分层架构的场景
- **项目规模**: 中小型项目 (5-10万行代码)
- **团队规模**: 3-5人
- **开发周期**: 中期项目
- **项目类型**: 企业内部系统
- **学习成本**: 低，3天上手

### 选择v3 DDD架构的场景
- **项目规模**: 大型复杂项目 (> 10万行代码)
- **团队规模**: 5+人
- **开发周期**: 长期维护项目
- **项目类型**: 复杂业务系统
- **学习成本**: 高，1-2周上手

## 架构特点对比

| 特性 | v4极简架构 | v2分层架构 | v3 DDD架构 |
|------|------------|------------|------------|
| **复杂度** | 极低 | 中等 | 高 |
| **开发速度** | 极快 | 快 | 慢 |
| **学习成本** | 极低 | 低 | 高 |
| **维护成本** | 极低 | 中等 | 高 |
| **扩展性** | 中等 | 高 | 极高 |
| **代码量** | 最少 | 中等 | 最多 |
| **抽象层级** | 1-2层 | 3-4层 | 5+层 |

## 目录结构对比

### v4 极简架构 (auto_test_simple)
```
auto_test_simple/
├── main.py              # FastAPI应用入口
├── config.py            # 统一配置管理
├── models/              # 数据模型
├── database/            # 数据库操作
├── api/                 # API路由
└── utils/               # 工具函数
```

### v2 分层架构
```
backend/src/auto_test/
├── main.py              # 应用入口
├── config.py            # 配置管理
├── database/            # 数据库层
├── utils/               # 工具模块
└── migrations/          # 数据迁移
```

### v3 DDD架构
```
backend/src/auto_test/
├── application/         # 应用层
├── domain/              # 领域层
├── infrastructure/      # 基础设施层
├── presentation/        # 表现层
└── shared/              # 共享模块
```

## 设计原则

### v4极简架构原则
1. **KISS原则** - Keep It Simple, Stupid
2. **单一职责** - 每个模块职责明确
3. **最小依赖** - 减少不必要的依赖
4. **快速迭代** - 支持快速开发和部署

### v2分层架构原则
1. **文件夹分类隔离** - 按功能模块分类
2. **分层架构** - API层 → 业务层 → 数据层
3. **依赖方向** - 单向依赖，上层依赖下层

### v3 DDD架构原则
1. **领域驱动** - 以业务领域为核心
2. **严格分层** - 清晰的层次边界
3. **依赖倒置** - 通过接口隔离依赖

## 迁移路径

### 从复杂架构迁移到极简架构 ⭐ 推荐
```
v3 DDD架构 → v2分层架构 → v4极简架构
```

**迁移步骤**:
1. **简化目录结构** - 减少层级嵌套
2. **合并相关功能** - 将分散的功能合并
3. **减少抽象层级** - 去除不必要的抽象
4. **直接依赖注入** - 简化依赖管理
5. **扁平化设计** - 采用扁平化的文件组织

### 从极简架构升级到复杂架构
```
v4极简架构 → v2分层架构 → v3 DDD架构
```

**升级时机**:
- 代码量超过5万行
- 团队规模超过3人
- 业务逻辑变得复杂
- 需要更好的可扩展性

## 实际项目状态

### 当前实现状态
- ✅ **v4极简架构** - 已完成实现 (`auto_test_simple/`)
- ✅ **v3 DDD架构** - 原有复杂实现 (`backend/src/auto_test/`)
- ⚠️ **v2分层架构** - 文档已更新，实现待完善

### 推荐使用
**强烈推荐使用v4极简架构** (`auto_test_simple/`)，因为：
1. **接口稳定** - 所有API接口正常工作
2. **代码简洁** - 易于理解和维护
3. **开发高效** - 快速开发和迭代
4. **文档完整** - 详细的开发指南

## 启动指南

### v4极简架构启动
```bash
# 初始化数据
python auto_test_simple/init_data.py

# 启动服务
python start_simple_api.py --debug --port 8003

# 查看API文档
open http://localhost:8003/docs
```

### v3 DDD架构启动
```bash
# 启动服务
cd backend/src
python -m auto_test.main

# 查看API文档
open http://localhost:8000/docs
```

## 最佳实践

### 通用最佳实践
1. **代码组织**: 按功能模块组织，避免按技术分类
2. **命名规范**: 使用清晰、一致的命名约定
3. **接口设计**: 定义清晰的接口边界
4. **错误处理**: 统一的错误处理机制
5. **日志记录**: 结构化的日志记录
6. **测试策略**: 分层的测试策略

### 极简架构特有实践
1. **保持简单**: 避免过度设计和抽象
2. **快速迭代**: 优先实现功能，后续优化
3. **渐进式复杂化**: 根据需要逐步增加复杂性
4. **文档驱动**: 保持文档与代码同步

## 相关文档

- [API设计规范](../api/README.md)
- [数据库设计](../database/README.md)
- [开发指南](../development/README.md)
- [部署指南](../deployment/README.md)

## 问题反馈

如果在使用过程中遇到问题，请：
1. 查看对应架构版本的文档
2. 检查启动指南和配置
3. 查看日志输出
4. 提交Issue或联系开发团队