# 前端架构设计指南

## 📋 概述

本文档详细说明前端系统的架构设计、组件体系和设计原则。前端采用Vue 3 + TypeScript + Element Plus技术栈，遵循防腐层设计和组件化开发原则。

## 🏗️ 整体架构设计

### 分层架构
```
┌─────────────────────────────────────────────────────────┐
│                    用户界面层                           │
│  - Vue 3 组件                                           │
│  - Element Plus UI                                      │
│  - 用户交互处理                                         │
└─────────────────┬───────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────┐
│                Composable防腐层                         │
│  - 状态管理 (Pinia)                                     │
│  - 业务逻辑协调                                         │
│  - 数据收集与组装                                       │
│  - 基础设施调用封装                                     │
└─────────────────┬───────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────┐
│                 API防腐层                               │
│  - HTTP请求封装                                         │
│  - 数据转换处理                                         │
│  - 错误处理统一                                         │
│  - 业务逻辑防腐                                         │
└─────────────────┬───────────────────────────────────────┘
                  │
┌─────────────────▼───────────────────────────────────────┐
│              基础设施层                                 │
│  - Axios HTTP客户端                                     │
│  - 路由管理 (Vue Router)                               │
│  - 工具函数库                                           │
│  - 类型定义系统                                         │
└─────────────────────────────────────────────────────────┘
```

### 核心设计原则
- **防腐层设计**: 每层都有明确的防腐职责
- **单一职责**: 每个模块只负责一个明确的业务领域
- **静态工具优先**: Converter、Rule、Wrapper使用静态方法
- **类型安全**: 严格的TypeScript类型系统
- **组件化**: 可复用的组件设计

## 🧩 核心组件架构

### 1. 系统管理组件体系
```
系统管理页面 (service-management/index.vue)
├── 左侧面板
│   ├── 系统类型筛选
│   └── SystemTree 组件
│       ├── 搜索功能
│       ├── 树形展示
│       └── 操作菜单
├── 右侧面板
│   ├── 系统详情展示
│   ├── 模块列表
│   └── 操作按钮
└── 对话框组件
    ├── 系统编辑对话框
    └── 模块编辑对话框
```

### 2. 工作流设计器组件体系
```
工作流设计器 (workflow-orchestration/designer.vue)
├── 节点库面板
│   ├── 节点分类展示
│   ├── 节点搜索功能
│   └── 拖拽创建节点
├── 画布区域
│   ├── Vue Flow 核心
│   ├── 节点组件渲染
│   └── 连线关系管理
├── 属性配置面板
│   ├── 通用属性配置
│   ├── 类型特定配置
│   └── 实时验证更新
└── 工具栏
    ├── 保存/加载
    ├── 执行控制
    └── 视图操作
```

### 3. API管理组件体系
```
API管理页面 (api-management/index.vue)
├── 左侧面板
│   └── SystemTree 组件 (复用)
│       └── 类别过滤：仅加载后端系统（backend）及其模块
├── 右侧面板
│   ├── 搜索筛选区域
│   ├── 批量操作区域
│   └── API列表展示
└── 对话框组件
    ├── API编辑对话框
    └── 参数配置对话框
```

### 4. 页面管理组件体系
```
页面管理页面 (page-management/index.vue)
├── 左侧面板
│   └── SystemTree 组件 (复用)
│       └── 类别过滤：仅加载前端系统（frontend）及其模块
├── 右侧面板
│   ├── 搜索筛选区域
│   ├── 页面列表展示
│   └── 页面API关联管理
└── 对话框组件
    ├── 页面编辑对话框
    └── API关联对话框
```

## 🔄 数据流设计

### 1. 标准数据流模式
```
用户操作 → 组件事件 → Composable处理 → API调用 → 数据更新 → 界面刷新
```

### 2. 状态管理模式
```
组件本地状态 (ref/reactive) ← → Composable状态 ← → Pinia全局状态
```

### 3. 错误处理流程
```
API错误 → HttpClient统一处理 → 用户提示 → 组件状态更新
```

## 🎨 组件设计规范

### 1. 组件分类
- **页面组件**: 完整的页面视图
- **业务组件**: 特定业务功能的组件
- **通用组件**: 可复用的基础组件
- **工具组件**: 辅助功能组件

### 2. 组件命名规范
- **页面组件**: `{Module}Index.vue`
- **业务组件**: `{Function}Component.vue`
- **通用组件**: `{Name}.vue`
- **对话框组件**: `{Name}Dialog.vue`

### 3. 组件结构规范
```vue
<template>
  <!-- 模板内容 -->
</template>

<script setup lang="ts">
// 导入
import { ref, computed, onMounted } from 'vue'

// 类型定义
interface Props {
  // props定义
}

// Props和Emits
const props = defineProps<Props>()
const emit = defineEmits<{
  // 事件定义
}>()

// 响应式数据
const loading = ref(false)

// 计算属性
const computedValue = computed(() => {
  // 计算逻辑
})

// 方法
const handleAction = () => {
  // 处理逻辑
}

// 生命周期
onMounted(() => {
  // 初始化逻辑
})
</script>

<style scoped>
/* 组件样式 */
</style>
```

## 🔧 API设计规范

### 1. API模块结构
```typescript
// /src/api/modules/{domain}-api.ts
class {Domain}Api {
  private readonly baseUrl = API_ENDPOINTS.{DOMAIN}

  async getList(params?: ListParams): Promise<ListResponse<{Domain}Data>> {
    // 实现
  }

  async getDetail(id: string | number): Promise<{Domain}Data> {
    // 实现
  }

  async create(data: Create{Domain}Params): Promise<{Domain}Data> {
    // 实现
  }

  async update(id: string | number, data: Update{Domain}Params): Promise<{Domain}Data> {
    // 实现
  }

  async delete(id: string | number): Promise<void> {
    // 实现
  }
}
```

### 2. Composable设计规范
```typescript
// /src/composables/use{Domain}Data.ts
export const use{Domain}Data = (options = {}) => {
  // 状态管理
  const data = ref<{Domain}Data[]>([])
  const loading = ref(false)
  const error = ref<string | null>(null)

  // 计算属性
  const dataCount = computed(() => data.value.length)

  // 方法
  const loadData = async () => {
    // 数据加载逻辑
  }

  const refreshData = async () => {
    // 数据刷新逻辑
  }

  return {
    data,
    loading,
    error,
    dataCount,
    loadData,
    refreshData
  }
}
```

## 🛡️ 安全规范

### 1. 数据验证
- 前端输入验证
- API响应验证
- 类型安全检查

### 2. 权限控制
- 路由权限验证
- 组件权限控制
- API权限检查

### 3. 数据安全
- 敏感信息脱敏
- XSS防护
- CSRF防护

## 📈 性能优化

### 1. 组件优化
- 合理使用 `v-memo`
- 避免不必要的重渲染
- 优化大列表渲染

### 2. 网络优化
- API请求缓存
- 并发请求控制
- 错误重试机制

### 3. 资源优化
- 图片懒加载
- 组件懒加载
- 第三方库按需引入

## 🖥️ 系统级UI与交互规范

### 响应式设计

```
响应式布局适配图
┌─────────────────────────────────────────────────────────────┐
│                      响应式设计系统                          │
├─────────────────────────────────────────────────────────────┤
│ 桌面端 (>1200px):                                           │
│ ┌─────────────┬─────────────────────────────────────────┐   │
│ │ 左侧导航    │ 右侧API管理面板                         │   │
│ │ 固定280px   │ 自适应剩余空间                          │   │
│ │             │ [API表格] 完整显示所有列                │   │
│ │             │ [操作按钮] 完整显示                     │   │
│ └─────────────┴─────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│ 平板端 (768px-1200px):                                      │
│ ┌───┬─────────────────────────────────────────────────┐     │
│ │☰ │ 右侧API管理面板                                 │     │
│ │   │ [API表格] 隐藏次要列                            │     │
│ │   │ [操作按钮] 收缩到下拉菜单                       │     │
│ └───┴─────────────────────────────────────────────────┘     │
├─────────────────────────────────────────────────────────────┤
│ 移动端 (<768px):                                            │
│ ┌─────────────────────────────────────────────────────┐     │
│ │ [☰] 搜索筛选区域 (垂直排列)                         │     │
│ │ ┌─────────────────────────────────────────────────┐ │     │
│ │ │ [API卡片布局] 替代表格                          │ │     │
│ │ │ [操作按钮] 简化为图标                           │ │     │
│ │ └─────────────────────────────────────────────────┘ │     │
│ └─────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────┘
```

#### 桌面端 (>1200px)
- 左侧导航固定宽度 280px
- 右侧内容区域自适应
- 表格完整显示所有列
- 完整显示所有操作按钮

#### 平板端 (768px-1200px)
- 左侧导航可折叠
- 表格隐藏部分次要列（如创建时间）
- 部分操作按钮收缩到下拉菜单

#### 移动端 (<768px)
- 左侧导航抽屉式显示
- 表格转为卡片式布局
- 操作按钮简化为图标
- 搜索筛选区域垂直排列

### 键盘快捷键

- `Ctrl/Cmd + N`: 新增
- `Ctrl/Cmd + F`: 聚焦搜索框
- `Ctrl/Cmd + R`: 刷新列表
- `Escape`: 关闭对话框
- `Enter`: 确认操作
- `Tab`: 在表单字段间切换

### 加载状态和反馈

#### 加载状态
- 页面初始化: 骨架屏显示
- 搜索加载: 搜索框显示加载图标
- 操作按钮: 显示加载状态
- 批量操作: 显示进度条

#### 用户反馈
- 成功操作: 绿色Toast消息
- 错误处理: 红色错误提示
- 警告信息: 橙色警告提示
- 信息提示: 蓝色信息提示

#### 空状态处理
- 无数据: 显示空状态插画和引导
- 搜索无结果: 提供搜索建议
- 网络错误: 显示重试按钮

### 常见问题与解决方案

#### 性能优化
- 虚拟滚动: 大量数据时使用虚拟表格
- 分页加载: 合理设置每页数据量（建议20-50条）
- 表格优化: 固定表头、列宽自适应
- 缓存策略: 缓存常用的筛选结果

#### 用户体验
- 操作确认: 重要操作提供二次确认
- 撤销功能: 支持删除操作的撤销
- 自动保存: 表单数据自动保存草稿
- 快速操作: 提供常用操作的快捷方式

#### 错误处理
- 网络异常: 提供重试机制
- 权限不足: 明确提示权限要求
- 数据冲突: 提供冲突解决方案
- 表单验证: 实时验证和错误提示

## 🔍 调试指南

### 1. 开发工具
- Vue DevTools
- TypeScript 语言服务
- Network 面板

### 2. 日志规范
```typescript
// 使用统一的日志工具
import { logger } from '@/utils/logger'

logger.info('操作成功', { data })
logger.error('操作失败', { error })
logger.debug('调试信息', { details })
```

### 3. 错误追踪
- 错误边界处理
- 错误上报机制
- 用户反馈收集

## 📝 文档维护

### 1. 文档同步
- 功能开发时同步更新文档
- 定期检查文档的准确性
- 保持文档与代码的一致性

### 2. 文档规范
- 遵循文档生成标准
- 使用统一的文档模板
- 提供清晰的示例代码

---

**文档版本**: v2.0  
**最后更新**: 2024年1月  
**维护者**: 前端开发团队