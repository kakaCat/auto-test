# API调用流程配置功能测试指南

## 功能概述

本文档描述了工作流可视化设计器中API调用流程配置功能的完整测试方法和验证步骤。该功能提供了两种配置模式，支持灵活的API调用节点配置和自动化参数生成。

## 功能特性

### 1. 双模式配置系统
- **工作流模式**：基于预定义工作流的智能配置
- **系统模式**：传统的系统-模块-API级联选择

### 2. 智能参数生成
- 自动生成请求参数模板
- 智能填充API接口信息
- 支持变量引用和动态参数

### 3. 实时验证和反馈
- JSON格式实时验证
- 参数配置错误提示
- 接口信息自动同步

## 测试环境准备

### 前置条件
1. **后端服务**：确保后端API服务正在运行 (`http://localhost:8000`)
2. **前端服务**：确保前端开发服务器正在运行 (`http://localhost:5173`)
3. **浏览器**：推荐使用Chrome或Firefox最新版本
4. **开发工具**：打开浏览器开发者工具以便调试

### 访问路径
1. 打开浏览器访问 `http://localhost:5173`
2. 导航到"工作流编排"页面
3. 进入工作流可视化设计器

## 详细测试用例

### 测试用例1：节点创建和选择

**测试步骤**：
1. 从左侧节点面板拖拽"API调用"节点到画布中央
2. 点击选择该API调用节点
3. 观察右侧属性面板的显示

**预期结果**：
- ✅ 节点成功创建并显示在画布上
- ✅ 选中节点后右侧显示"节点属性"面板
- ✅ 面板显示"API调用流程配置"部分
- ✅ 默认显示配置模式选择器

### 测试用例2：配置模式切换

**测试步骤**：
1. 在属性面板中找到"配置模式"选择器
2. 验证默认选中的模式
3. 点击切换到"工作流模式"
4. 观察界面变化
5. 切换到"系统模式"
6. 再次观察界面变化

**预期结果**：
- ✅ 配置模式选择器正常显示两个选项
- ✅ 切换到工作流模式时显示：工作流选择器、API接口选择器
- ✅ 切换到系统模式时显示：系统选择器、模块选择器、API选择器
- ✅ 模式切换时界面平滑过渡，无闪烁或错误

### 测试用例3：工作流模式完整流程

**测试步骤**：
1. 选择"工作流模式"
2. 点击"工作流"下拉选择器
3. 验证工作流列表加载
4. 选择"用户注册流程"
5. 观察API接口选择器的变化
6. 选择"创建用户账户"API接口
7. 检查自动填充的配置信息

**预期结果**：
- ✅ 工作流下拉列表显示3个选项：
  - 用户注册流程
  - 订单处理流程
  - 支付验证流程
- ✅ 选择工作流后，API接口列表自动更新
- ✅ 选择API接口后，以下信息自动填充：
  - 请求方法：POST
  - 请求路径：/api/users/register
  - 响应格式：JSON
  - 请求参数：包含用户注册相关字段的JSON模板
  - 请求头：包含Content-Type等标准头信息

### 测试用例4：系统模式级联选择

**测试步骤**：
1. 选择"系统模式"
2. 在系统选择器中选择一个系统
3. 观察模块选择器的变化
4. 选择一个模块
5. 观察API选择器的变化
6. 选择一个API接口

**预期结果**：
- ✅ 系统选择器显示可用系统列表
- ✅ 选择系统后，模块列表根据系统动态加载
- ✅ 选择模块后，API列表根据模块动态加载
- ✅ 级联选择过程中显示适当的加载状态

### 测试用例5：参数模板生成和验证

**测试步骤**：
1. 在工作流模式下选择不同的API接口
2. 检查生成的请求参数格式
3. 验证JSON语法的正确性
4. 检查变量引用格式
5. 尝试修改参数内容
6. 验证实时格式检查

**预期结果**：
- ✅ 不同API接口生成不同的参数模板
- ✅ 生成的JSON格式正确，可以被解析
- ✅ 变量引用使用正确格式：`${variableName}`
- ✅ 修改参数时有实时格式验证
- ✅ 无效JSON格式时显示错误提示

### 测试用例6：接口信息展示

**测试步骤**：
1. 选择不同的API接口
2. 检查"接口信息"部分的显示
3. 验证请求方法、路径、响应格式的准确性
4. 检查信息更新的及时性

**预期结果**：
- ✅ 接口信息准确显示：
  - 请求方法：GET/POST/PUT/DELETE
  - 请求路径：完整的API路径
  - 响应格式：JSON/XML等
- ✅ 切换接口时信息立即更新
- ✅ 信息显示格式清晰易读

### 测试用例7：执行配置

**测试步骤**：
1. 在API调用节点配置中找到"执行配置"部分
2. 测试超时时间设置（1000-300000毫秒）
3. 测试重试次数设置（0-5次）
4. 测试错误处理方式选择

**预期结果**：
- ✅ 超时时间输入框接受有效范围内的数值
- ✅ 重试次数选择器显示0-5的选项
- ✅ 错误处理方式包含：停止执行、继续执行、重试后停止
- ✅ 配置项的默认值合理

### 测试用例8：数据持久化

**测试步骤**：
1. 完整配置一个API调用节点
2. 保存工作流
3. 重新加载页面
4. 加载保存的工作流
5. 检查API调用节点的配置是否保持

**预期结果**：
- ✅ 配置信息正确保存
- ✅ 重新加载后配置信息完整恢复
- ✅ 所有配置项都保持原有状态

## 性能测试

### 响应时间测试
1. **工作流列表加载**：< 500ms
2. **API接口列表加载**：< 300ms
3. **参数模板生成**：< 100ms
4. **模式切换响应**：< 50ms

### 并发测试
1. 同时配置多个API调用节点
2. 快速切换配置模式
3. 验证界面响应和数据一致性

## 兼容性测试

### 浏览器兼容性
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+

### 设备兼容性
- ✅ 桌面端（1920x1080及以上）
- ✅ 笔记本（1366x768及以上）
- ⚠️ 平板设备（部分功能受限）
- ❌ 移动设备（不推荐使用）

## 错误场景测试

### 测试用例9：网络异常处理

**测试步骤**：
1. 断开网络连接
2. 尝试加载工作流列表
3. 恢复网络连接
4. 验证自动重试机制

**预期结果**：
- ✅ 网络异常时显示友好的错误提示
- ✅ 网络恢复后能够自动重试
- ✅ 不会因为网络问题导致页面崩溃

### 测试用例10：数据异常处理

**测试步骤**：
1. 输入无效的JSON格式参数
2. 设置超出范围的超时时间
3. 选择不存在的API接口

**预期结果**：
- ✅ 无效JSON格式时显示具体错误信息
- ✅ 超出范围的数值被自动修正或提示
- ✅ 不存在的选项被正确处理

## 用户体验测试

### 易用性评估
1. **学习成本**：新用户能否在5分钟内完成基本配置
2. **操作效率**：熟练用户配置一个API节点的时间
3. **错误恢复**：用户犯错后的恢复难度

### 界面友好性
1. **视觉设计**：界面元素是否清晰易识别
2. **交互反馈**：操作是否有及时的视觉反馈
3. **帮助信息**：是否提供足够的操作指导

## 模拟数据详情

### 工作流数据结构
```json
{
  "id": "workflow_001",
  "name": "用户注册流程",
  "description": "完整的用户注册和验证流程",
  "apiFlows": [
    {
      "id": "api_001",
      "name": "创建用户账户",
      "method": "POST",
      "path": "/api/users/register",
      "responseFormat": "JSON"
    }
  ]
}
```

### API接口数据结构
```json
{
  "id": "api_001",
  "name": "创建用户账户",
  "method": "POST",
  "path": "/api/users/register",
  "responseFormat": "JSON",
  "requestTemplate": {
    "username": "${username}",
    "email": "${email}",
    "password": "${password}"
  },
  "headers": {
    "Content-Type": "application/json",
    "Accept": "application/json"
  }
}
```

## 后续优化建议

### 功能增强
1. **智能推荐**：基于历史配置推荐相关API接口
2. **批量配置**：支持批量配置多个相似的API节点
3. **模板管理**：允许用户保存和复用配置模板
4. **版本控制**：支持配置的版本管理和回滚

### 性能优化
1. **缓存机制**：缓存常用的工作流和API列表
2. **懒加载**：按需加载API接口详情
3. **虚拟滚动**：处理大量API列表时的性能优化
4. **预加载**：预加载可能需要的数据

### 用户体验改进
1. **搜索功能**：在工作流和API列表中添加搜索
2. **收藏功能**：允许用户收藏常用的配置
3. **快捷操作**：提供键盘快捷键支持
4. **操作历史**：记录和恢复用户的操作历史

## 问题反馈

### 常见问题解决
1. **配置不生效**：检查JSON格式和必填字段
2. **列表加载失败**：检查网络连接和后端服务状态
3. **参数模板错误**：验证API接口定义的正确性
4. **界面显示异常**：清除浏览器缓存并刷新页面

### 反馈渠道
1. **技术支持**：通过内部技术支持渠道报告问题
2. **问题跟踪**：在项目管理系统中创建问题单
3. **改进建议**：通过产品反馈渠道提交改进建议

---

*最后更新时间：2024年1月*
*测试版本：v1.0.0*