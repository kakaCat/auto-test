# 页面调用流程用户指南

## 概述

页面调用流程是AI自动化测试系统第4层架构中的独立功能模块，专门用于设计和执行页面操作的自动化流程。与API调用流程并行，页面调用流程专注于UI交互驱动的自动化测试，适合用户界面测试和端到端验证。

> 当前实现状态与链接
>
> - 页面路径（规划中）：`/page-call-flow`
> - 模块状态：🚧 规划中（尚未发布前端路由与页面）
> - 相关文档：
>   - 《工作流设计器指南》：`./07-workflow-designer.md`
>   - 《AI编排与执行指南》：`./10-ai-orchestration-and-execution.md`

## 功能定位

### 与API调用流程的区别

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            第4层: 调用流程对比                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│ API调用流程                          │ 页面调用流程                            │
│ ┌─────────────────────────────────┐  │ ┌─────────────────────────────────────┐ │
│ │ • 专注API接口串联               │  │ │ • 专注页面操作串联                  │ │
│ │ • 数据驱动的自动化测试          │  │ │ • UI交互驱动的自动化测试            │ │
│ │ • 适合接口测试和业务逻辑验证    │  │ │ • 适合界面测试和端到端验证          │ │
│ │ • 页面路径: /workflow-orchestration │ │ • 页面路径: /page-call-flow         │ │
│ │ • 实现状态: ✅ 已实现           │  │ │ • 实现状态: 🚧 规划中               │ │
│ └─────────────────────────────────┘  │ └─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 界面设计规划

### 页面调用流程设计器界面

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              页面调用流程设计器                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                工具栏                                           │
│ [保存] [加载] [清空] [执行] [停止] [调试] [录制] [页面选择]                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│ 页面节点面板 │                        画布区域                      │ 属性面板      │
│ ┌─────────┐ │ ┌─────────────────────────────────────────────────┐ │ ┌─────────┐ │
│ │🌐页面导航│ │ │                                                 │ │ │页面操作 │ │
│ │👆点击操作│ │ │           拖拽页面节点到此处开始设计            │ │ │配置区域 │ │
│ │⌨️输入操作│ │ │                                                 │ │ │         │ │
│ │👁️等待验证│ │ │                                                 │ │ │         │ │
│ │📸截图记录│ │ │                                                 │ │ │         │ │
│ │🔀条件分支│ │ │                                                 │ │ │         │ │
│ └─────────┘ │ └─────────────────────────────────────────────────┘ │ └─────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 页面节点类型

### 🌐 页面导航节点 (Page Navigation Node)
- **用途**: 页面跳转和导航操作
- **配置项**:
  - 目标URL或页面路径
  - 等待页面加载完成
  - 页面加载超时设置

### 👆 页面操作节点 (Page Action Node)
- **用途**: 页面元素的交互操作
- **操作类型**:
  - **点击操作**: 按钮、链接、菜单项点击
  - **输入操作**: 文本框、下拉框、复选框输入
  - **选择操作**: 单选、多选、下拉选择
  - **拖拽操作**: 元素拖拽和排序

### 👁️ 等待验证节点 (Wait & Verify Node)
- **用途**: 等待页面状态变化和结果验证
- **验证类型**:
  - **元素存在**: 验证指定元素是否存在
  - **文本内容**: 验证文本内容是否符合预期
  - **页面状态**: 验证页面加载状态和URL变化
  - **属性值**: 验证元素属性值

### 📸 截图记录节点 (Screenshot Node)
- **用途**: 记录页面状态和操作过程
- **配置项**:
  - 截图时机（操作前/后）
  - 截图范围（全页面/指定区域）
  - 图片质量和格式

## 页面操作配置

### 元素定位配置

#### 系统级联选择
基于第3层的页面管理资源：
```
页面级联配置:
├─ 第1层-系统选择: 电商管理系统
├─ 第2层-模块选择: 用户管理模块
└─ 第3层-页面选择: 用户登录页面
    ├─ 页面URL: https://admin.example.com/login
    ├─ 页面元素: 从页面管理中自动加载
    └─ 操作定义: 预定义的页面操作
```

#### 元素定位方式
```json
{
  "element_locators": {
    "username_input": {
      "primary": {"type": "id", "value": "username"},
      "fallback": [
        {"type": "css", "value": "input[name='username']"},
        {"type": "xpath", "value": "//input[@placeholder='用户名']"}
      ]
    },
    "login_button": {
      "primary": {"type": "css", "value": "button[type='submit']"},
      "fallback": [
        {"type": "xpath", "value": "//button[contains(text(), '登录')]"}
      ]
    }
  }
}
```

### 操作流程配置

#### 登录流程示例
```
流程名称: 用户登录页面流程
节点串联:
  开始 → 打开登录页面 → 输入用户名 → 输入密码 → 点击登录按钮 → 
  等待页面跳转 → 验证登录成功 → 截图记录 → 结束

详细配置:
  1. 页面导航节点:
     - URL: https://admin.example.com/login
     - 等待加载: 页面完全加载
  
  2. 输入操作节点:
     - 元素: username_input
     - 值: ${test_data.username}
     - 清空后输入: true
  
  3. 验证节点:
     - 验证类型: URL包含
     - 预期值: /dashboard
     - 超时时间: 10秒
```

## 数据传递和变量

### 页面数据提取
```json
{
  "data_extraction": {
    "user_info": {
      "element": "user_welcome_message",
      "extract_type": "text",
      "output_variable": "current_user_name"
    },
    "page_title": {
      "element": "page_title",
      "extract_type": "text",
      "output_variable": "current_page_title"
    },
    "form_data": {
      "element": "user_form",
      "extract_type": "form_values",
      "output_variable": "form_data"
    }
  }
}
```

### 变量引用
```json
{
  "variable_usage": {
    "input_value": "${previous_node.extracted_data}",
    "conditional_value": "${user_info.role == 'admin' ? 'admin_panel' : 'user_panel'}",
    "dynamic_selector": "button[data-user-id='${user_node.user_id}']"
  }
}
```

## 执行和监控

### 执行模式

#### 正常执行
- 按节点顺序依次执行页面操作
- 实时显示执行进度和状态
- 自动处理页面加载和元素等待

#### 调试模式
- 逐步执行每个页面操作
- 在每个操作后暂停，显示页面状态
- 支持手动调整和继续执行

#### 录制模式
- 录制用户的实际页面操作
- 自动生成页面调用流程
- 支持录制回放和编辑优化

### 状态监控

#### 执行状态
- **🟢 执行中**: 页面操作正在执行
- **🔵 等待中**: 等待页面加载或元素出现
- **✅ 成功**: 操作执行成功
- **❌ 失败**: 操作执行失败
- **⏸️ 暂停**: 调试模式下的暂停状态

#### 性能监控
```json
{
  "performance_metrics": {
    "page_load_time": "页面加载时间",
    "element_wait_time": "元素等待时间",
    "action_response_time": "操作响应时间",
    "total_execution_time": "总执行时间"
  }
}
```

## 与其他模块的集成

### 与页面管理的关系
- 页面调用流程使用页面管理中定义的页面信息
- 自动加载页面的元素定位和操作定义
- 支持页面配置的实时同步更新

### 与API调用流程的协作
- 可以在页面流程中调用API流程
- 支持页面操作触发API调用
- 实现UI测试和接口测试的混合流程
- 推荐阅读：`./07-workflow-designer.md`

### 与场景管理的关系
- 页面调用流程可以作为测试场景的基础
- 支持基于页面流程创建UI测试场景
- 提供端到端测试的完整解决方案

### 与编排执行与监控的协作
- 页面调用流程的执行与监控能力与AI编排共用运行与追踪基础设施
- 运行侧接口与事件契约参考：《AI编排与执行指南》：`./10-ai-orchestration-and-execution.md`

## 使用场景

### 典型应用场景

#### 1. 用户注册流程测试
```
流程设计:
  打开注册页面 → 填写用户信息 → 提交注册 → 验证邮箱 → 
  激活账号 → 登录验证 → 检查用户状态

验证点:
  - 表单验证提示正确显示
  - 注册成功消息正确显示
  - 邮箱验证链接有效
  - 账号激活后可正常登录
```

#### 2. 电商购物流程测试
```
流程设计:
  用户登录 → 搜索商品 → 查看商品详情 → 添加购物车 → 
  结算页面 → 填写地址 → 选择支付 → 确认订单

验证点:
  - 商品信息显示正确
  - 购物车数量更新正确
  - 订单金额计算准确
  - 支付流程完整无误
```

#### 3. 管理后台操作流程
```
流程设计:
  管理员登录 → 进入用户管理 → 搜索用户 → 编辑用户信息 → 
  保存修改 → 验证更新结果

验证点:
  - 权限控制正确
  - 数据修改成功
  - 界面反馈及时
  - 操作日志记录
```

## 最佳实践

### 流程设计原则
1. **操作原子性**: 每个节点只执行一个具体操作
2. **等待策略**: 合理设置元素等待和页面加载时间
3. **错误处理**: 为关键操作配置重试和异常处理
4. **数据验证**: 在关键步骤添加验证节点

### 稳定性优化
1. **元素定位**: 使用稳定的定位方式，提供备用定位
2. **智能等待**: 使用条件等待而不是固定延时
3. **异常恢复**: 配置操作失败后的恢复策略
4. **环境适配**: 考虑不同浏览器和设备的兼容性

### 维护性考虑
1. **模块化设计**: 将常用操作封装为可复用模块
2. **参数化配置**: 使用变量和参数提高流程的通用性
3. **版本管理**: 跟踪页面变更对流程的影响
4. **文档维护**: 及时更新流程文档和说明

## 开发计划

### 功能规划

#### 第一阶段: 基础功能
- [ ] 页面调用流程列表管理
- [ ] 基础页面操作节点（导航、点击、输入）
- [ ] 简单的流程执行引擎
- [ ] 基本的状态监控

#### 第二阶段: 高级功能
- [ ] 可视化页面流程设计器
- [ ] 复杂页面操作节点（拖拽、多选、条件操作）
- [ ] 智能元素定位和等待策略
- [ ] 页面录制和回放功能

#### 第三阶段: 集成功能
- [ ] 与API调用流程的混合执行
- [ ] 与测试场景的深度集成
- [ ] 跨浏览器兼容性支持
- [ ] 性能监控和优化

### 技术实现

#### 前端技术栈
- **Vue 3 + Element Plus**: 界面框架
- **Vue Flow**: 可视化流程设计器
- **Playwright/Selenium**: 页面自动化执行引擎
- **WebSocket**: 实时状态监控

#### 后端支持
- **页面操作执行器**: 执行页面操作指令
- **元素定位服务**: 智能元素定位和识别
- **截图服务**: 页面截图和图像处理
- **状态管理**: 执行状态和结果管理

## 使用指南

### 当前可用功能

由于页面调用流程功能还在规划中，目前可以通过以下方式实现页面测试：

#### 1. 使用API调用流程模拟
- 在工作流设计器中创建页面相关的API调用
- 通过API接口验证页面操作的后端效果
- 适合数据验证和业务逻辑测试

#### 2. 结合页面管理功能
- 在页面管理中配置页面信息和API关联
- 使用API调用流程验证页面背后的接口调用
- 实现部分的页面测试覆盖

### 未来使用方式

#### 完整的页面调用流程
当功能完全实现后，用户将能够：

1. **创建页面流程**
   - 从页面节点面板拖拽操作节点
   - 配置页面元素定位和操作参数
   - 设置验证规则和断言条件

2. **执行页面流程**
   - 启动浏览器自动化执行
   - 实时监控操作进度和状态
   - 查看执行结果和截图记录

3. **调试和优化**
   - 使用调试模式逐步执行
   - 调整元素定位和等待策略
   - 优化流程稳定性和性能

## 常见问题

### Q1: 页面调用流程与API调用流程有什么区别？
**A**: 
- **API调用流程**: 专注于后端接口的调用和数据验证
- **页面调用流程**: 专注于前端页面的操作和UI验证
- 两者可以独立使用，也可以组合使用实现完整的端到端测试

### Q2: 什么时候使用页面调用流程？
**A**: 
- 需要验证用户界面交互时
- 进行端到端业务流程测试时
- 验证页面显示和用户体验时
- API测试无法覆盖的UI逻辑时

### Q3: 页面调用流程如何与现有功能集成？
**A**: 
- 使用页面管理中的页面配置信息
- 可以调用API调用流程进行数据准备
- 结果可以用于创建测试场景
- 与整个5层架构体系无缝集成

## 总结

页面调用流程作为第4层架构中的独立模块，与API调用流程并行，共同构成完整的调用流程体系。虽然目前还在规划阶段，但其设计理念和功能定位已经明确，将为用户提供强大的UI自动化测试能力。

通过页面调用流程，用户将能够：
- 设计复杂的页面操作流程
- 实现UI自动化测试
- 验证用户界面和交互体验
- 构建完整的端到端测试场景

期待这个功能的正式实现，为AI自动化测试系统增添更强大的测试能力！🎉