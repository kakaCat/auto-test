# API管理页面交互文档

## 文档信息

| 属性 | 值 |
|------|-----|
| 文档ID | DOC-UG-004 |
| 文档版本 | v2.1.0 |
| 创建时间 | 2024-01-15 |
| 更新时间 | 2024-12-19 |
| 文档负责人 | 前端团队 |
| 审核状态 | 已审核 |
| 适用版本 | v2.0.0+ |

## 🎯 模块概述

### 核心功能
API管理页面是AI自动化测试系统的核心功能模块，位于6层架构体系的第3层（资源管理层），提供完整的API生命周期管理能力。

**主要功能特性：**
- **API生命周期管理**: 创建、编辑、删除、版本控制
- **智能搜索与筛选**: 支持多维度搜索和高级筛选
- **模块化分类管理**: 基于系统和模块的层级管理
- **批量操作**: 支持批量导入、导出、状态更新
- **在线测试**: 内置API测试工具，支持参数配置和结果分析
- **请求监控**: 实时监控API调用情况和性能指标

### 技术特性
- **TypeScript**: 完整的类型安全保障
- **组件化设计**: 高度可复用的UI组件
- **状态管理**: 基于Pinia的响应式状态管理
- **API集成**: RESTful API集成和错误处理
- **错误处理**: 多层次错误处理和用户友好提示

## 👥 详细使用场景

### 前端开发者
**典型工作流程：**
1. **API信息录入** → 2. **接口测试验证** → 3. **文档维护更新**

**详细操作步骤：**
- 登录系统，进入API管理页面
- 选择对应的系统和模块分类
- 创建新API接口，填写完整的接口信息
- 配置请求参数、响应格式和示例数据
- 使用内置测试工具验证接口功能
- 维护API文档和版本信息

**用户价值：** 统一管理前端调用的所有API接口，确保接口信息准确性和一致性

### 测试工程师
**典型工作流程：**
1. **测试用例设计** → 2. **接口功能验证** → 3. **测试报告生成**

**详细操作步骤：**
- 查看API列表，了解待测试的接口
- 使用搜索和筛选功能快速定位目标API
- 配置测试参数，执行接口测试
- 分析测试结果，验证接口功能正确性
- 记录测试问题，跟踪修复进度

**用户价值：** 提供完整的API测试环境，支持快速验证和问题定位

### 项目经理
**典型工作流程：**
1. **项目进度跟踪** → 2. **接口开发监控** → 3. **质量评估分析**

**详细操作步骤：**
- 查看API开发进度和状态统计
- 监控接口测试覆盖率和通过率
- 分析API性能指标和调用频次
- 生成项目报告和质量评估

**用户价值：** 实时掌握API开发进度，确保项目按时交付

### 运维工程师
**典型工作流程：**
1. **系统监控** → 2. **性能分析** → 3. **故障排查**

**详细操作步骤：**
- 监控API调用状态和响应时间
- 分析接口性能瓶颈和异常情况
- 配置告警规则和通知机制
- 处理接口故障和性能优化

**用户价值：** 保障API服务稳定运行，提升系统可用性

## 页面概述

API管理页面是自动化测试平台的核心功能模块，用于管理和维护系统中的API接口。页面提供了完整的API生命周期管理功能，包括创建、编辑、删除、搜索、导入导出等操作。

## 文档结构与规范（采用 07 方式）

本页遵循“07文档写作方式”，推荐章节顺序为：
- 架构定位 → 功能概述 → 界面布局 → 交互与操作 → 页面弹框与抽屉 → 状态与数据流 → 事件与契约 → 数据模型 → 自测清单 → 常见问题

说明：与“新增API”相关的对话框说明已内联在“交互流程 → 新增API”中，并已添加交叉链接；同时已在下文“页面弹框与抽屉”章节集中描述，保持与07体例一致。

## 界面布局

### 整体结构
```
┌─────────────────────────────────────────────────────────────┐
│                        页面头部                              │
│  [API管理] [描述文本] [新增API] [导入] [导出] [批量操作]      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────┐  ┌─────────────────────────────────────┐   │
│  │             │  │                                     │   │
│  │   左侧导航   │  │           右侧API管理面板            │   │
│  │  SystemTree │  │                                     │   │
│  │             │  │  ┌─────────────────────────────┐    │   │
│  │   系统列表   │  │  │        搜索筛选区域          │    │   │
│  │   模块分类   │  │  └─────────────────────────────┘    │   │
│  │             │  │                                     │   │
│  │             │  │  ┌─────────────────────────────┐    │   │
│  │             │  │  │        API列表展示          │    │   │
│  │             │  │  │                             │    │   │
│  │             │  │  │  [API卡片1] [API卡片2]      │    │   │
│  │             │  │  │  [API卡片3] [API卡片4]      │    │   │
│  │             │  │  │                             │    │   │
│  │             │  │  └─────────────────────────────┘    │   │
│  │             │  │                                     │   │
│  │             │  │  ┌─────────────────────────────┐    │   │
│  │             │  │  │        分页控件             │    │   │
│  │             │  │  └─────────────────────────────┘    │   │
│  └─────────────┘  └─────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 头部区域

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              头部区域布局图                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│  📋 API管理                                    [新增API] [导入] [导出] [批量▼] │
│  📝 管理和维护系统API接口                                                    │
├─────────────────────────────────────────────────────────────────────────────┤
│  组件说明：                                                                 │
│  • 页面标题：左侧显示主标题和图标                                           │
│  • 描述文本：标题下方的功能说明                                             │
│  • 操作按钮：右侧按钮组，支持主要和次要操作                                 │
│  • 批量操作：下拉菜单形式，包含多种批量处理功能                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

- **页面标题**: "API管理"
- **描述文本**: "管理和维护系统API接口"
- **操作按钮组**:
  - `新增API`: 主要操作按钮，蓝色背景
  - `导入`: 次要操作按钮，支持批量导入
  - `导出`: 次要操作按钮，支持数据导出
  - `批量操作`: 下拉菜单，包含批量删除、批量更新状态等

### 左侧导航面板

```
┌─────────────────────────────────────┐
│          左侧导航面板结构图          │
├─────────────────────────────────────┤
│ 🔄 [刷新]                          │
├─────────────────────────────────────┤
│ 📁 系统A (backend)          [▼]    │
│   ├─ 📂 用户模块                   │
│   ├─ 📂 订单模块                   │
│   └─ 📂 支付模块                   │
├─────────────────────────────────────┤
│ 📁 系统B (backend)          [▶]    │
├─────────────────────────────────────┤
│ 📁 系统C (backend)          [▼]    │
│   ├─ 📂 商品模块                   │
│   └─ 📂 库存模块                   │
├─────────────────────────────────────┤
│ 交互功能：                          │
│ • 点击系统：筛选该系统所有API       │
│ • 点击模块：筛选该模块API           │
│ • 展开/收起：[▼]/[▶] 控制子节点     │
│ • 右键菜单：编辑/删除/添加操作      │
│ • 拖拽排序：调整节点顺序            │
└─────────────────────────────────────┘
```

- **SystemTree组件**: 系统和模块树形结构
- **功能特性**:
  - 展示系统和模块层级结构
  - 支持系统和模块筛选
  - 点击系统节点筛选该系统下所有API
  - 点击模块节点筛选该系统和模块对应的API

#### 系统和模块树形结构
 - **类别过滤**：仅展示后端服务类别（`backend`）系统及其模块；隐藏其他类别。
- **系统节点**: 显示系统名称，支持展开查看模块
- **模块节点**: 显示模块名称，作为系统的子节点
- **展开/收起**: 点击系统节点展开或收起模块列表
- **节点选择**: 
  - 点击系统节点：筛选该系统下所有API
  - 点击模块节点：筛选该系统和模块对应的API
- **刷新按钮**: 重新加载系统和模块树结构

#### 筛选功能
- **系统筛选**: 选择系统节点时，右侧API列表显示该系统的所有API
- **模块筛选**: 选择模块节点时，右侧API列表显示该模块的所有API
- **筛选状态**: 导航面板显示当前选中的系统/模块状态
- **清除筛选**: 支持清除当前筛选条件，显示所有API

#### 交互功能
- **节点点击**: 选中系统或模块，右侧显示对应API列表
- **多选支持**: 支持选择多个系统/模块进行批量操作
- **拖拽排序**: 支持系统和模块节点拖拽调整顺序
- **右键菜单**: 提供编辑、删除、添加子模块等操作

### 右侧API管理面板

#### 搜索筛选区域
```
┌─────────────────────────────────────────────────────────┐
│ [搜索框: 输入API名称或路径]  [搜索按钮]  [重置按钮]      │
├─────────────────────────────────────────────────────────┤
│ 筛选条件:                                               │
│ [HTTP方法▼] [状态▼] [分类▼] [创建时间▼] [更多筛选▼]     │
└─────────────────────────────────────────────────────────┘
```

#### API列表展示
API以表格形式展示，包含以下列：
```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│ API列表表格                                                                          │
├──┬─────────────┬────────┬─────────────────┬──────────┬─────────────┬─────────────────┤
│☐ │ API名称     │ 方法   │ 路径            │ 状态     │ 系统/模块   │ 操作            │
├──┼─────────────┼────────┼─────────────────┼──────────┼─────────────┼─────────────────┤
│☐ │ 用户登录    │ POST   │ /api/v1/login   │ 启用     │ 用户系统    │ [编辑][删除]    │
│☐ │ 获取用户信息│ GET    │ /api/v1/user    │ 启用     │ 用户系统    │ [编辑][删除]    │
│☐ │ 创建订单    │ POST   │ /api/v1/order   │ 禁用     │ 订单系统    │ [编辑][删除]    │
│☐ │ 查询订单    │ GET    │ /api/v1/order   │ 启用     │ 订单系统    │ [编辑][删除]    │
│☐ │ 支付接口    │ POST   │ /api/v1/pay     │ 开发中   │ 支付系统    │ [编辑][删除][测试][复制] │
└──┴─────────────┴────────┴─────────────────┴──────────┴─────────────┴─────────────────┘

表格列说明：
- 复选框：支持多选进行批量操作
- API名称：接口的业务名称，可点击查看详情
- 方法：HTTP方法（GET、POST、PUT、DELETE等）
- 路径：API的完整路径
- 状态：启用、禁用、开发中等状态标签
- 系统/模块：所属系统和模块信息
- 操作：编辑、删除、测试、复制等操作按钮（窄屏下收拢为“更多 ▾”下拉）
```

## 🎨 设计规范

### 页面尺寸与布局
- **最小宽度**: 1200px
- **推荐宽度**: 1440px及以上
- **左侧导航宽度**: 280px（可调整范围：240px-320px）
- **内容区域间距**: 16px标准间距，24px大间距
- **组件圆角**: 4px（小组件），8px（卡片组件）

### 色彩系统
```
主色调 (Primary Colors):
├─ 主色: #1890ff (蓝色)
├─ 主色悬停: #40a9ff
├─ 主色激活: #096dd9
└─ 主色禁用: #d9d9d9

辅助色 (Secondary Colors):
├─ 成功: #52c41a (绿色)
├─ 警告: #faad14 (橙色)  
├─ 错误: #ff4d4f (红色)
└─ 信息: #1890ff (蓝色)

中性色 (Neutral Colors):
├─ 标题: #262626 (深灰)
├─ 正文: #595959 (中灰)
├─ 辅助文字: #8c8c8c (浅灰)
├─ 边框: #d9d9d9 (边框灰)
└─ 背景: #fafafa (背景灰)

状态色 (Status Colors):
├─ 启用状态: #52c41a (绿色)
├─ 禁用状态: #d9d9d9 (灰色)
├─ 开发中: #faad14 (橙色)
└─ 错误状态: #ff4d4f (红色)
```

### 字体规范
```
字体家族:
├─ 中文: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif
└─ 代码: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace

字体大小:
├─ 页面标题: 20px (font-weight: 600)
├─ 区块标题: 16px (font-weight: 500)  
├─ 正文内容: 14px (font-weight: 400)
├─ 辅助信息: 12px (font-weight: 400)
└─ 代码文本: 13px (font-family: monospace)

行高设置:
├─ 标题行高: 1.2
├─ 正文行高: 1.5
└─ 代码行高: 1.4
```

### 设计原则
- **一致性**: 保持界面元素、交互行为、视觉风格的一致性
- **易用性**: 优化用户操作流程，减少认知负担
- **可访问性**: 支持键盘导航、屏幕阅读器、高对比度模式
- **响应式**: 适配不同屏幕尺寸和设备类型

## 📱 响应式设计

### 断点系统
```
屏幕断点定义:
├─ 超小屏 (xs): < 576px
├─ 小屏 (sm): 576px - 768px
├─ 中屏 (md): 768px - 992px  
├─ 大屏 (lg): 992px - 1200px
└─ 超大屏 (xl): ≥ 1200px
```

### 多设备适配策略
- **桌面端 (≥1200px)**: 完整功能展示，双栏布局
- **平板端 (768px-1199px)**: 左侧导航可收起，表格横向滚动
- **手机端 (<768px)**: 单栏布局，抽屉式导航，卡片式列表

### 组件响应式设计
- **导航面板**: 大屏固定显示，小屏抽屉模式
- **API列表**: 大屏表格模式，小屏卡片模式
- **操作按钮**: 大屏完整显示，小屏收拢为下拉菜单
- **搜索筛选**: 大屏水平排列，小屏垂直堆叠

### 性能优化
- **虚拟滚动**: API列表支持虚拟滚动，处理大量数据
- **分页加载**: 默认每页20条，支持分页和无限滚动
- **懒加载**: 图片和非关键资源延迟加载
- **代码分割**: 按需加载功能模块，减少初始包大小

## 🔧 用户体验优化

### 加载状态设计
- **页面加载**: 骨架屏显示页面结构
- **数据加载**: 表格行显示加载动画
- **操作反馈**: 按钮显示加载状态和进度

### 操作反馈机制
- **成功操作**: 绿色提示消息，自动消失
- **错误操作**: 红色错误提示，需手动关闭
- **警告操作**: 橙色警告提示，确认后执行
- **信息提示**: 蓝色信息提示，提供操作指导

### 键盘快捷键
```
快捷键定义:
├─ Ctrl/Cmd + N: 新增API
├─ Ctrl/Cmd + S: 保存当前编辑
├─ Ctrl/Cmd + F: 聚焦搜索框
├─ Ctrl/Cmd + A: 全选API列表
├─ Delete: 删除选中API
├─ Enter: 确认操作
├─ Escape: 取消操作/关闭弹框
└─ Tab: 焦点切换
```

### 无障碍设计
- **语义化标签**: 使用正确的HTML语义标签
- **ARIA属性**: 添加必要的ARIA标签和属性
- **焦点管理**: 合理的Tab键导航顺序
- **颜色对比**: 确保文字和背景有足够对比度
- **屏幕阅读器**: 支持主流屏幕阅读器软件

## 交互流程

```
页面初始化流程图
┌─────────────────────────────────────────────────────────────┐
│                     页面初始化流程                          │
├─────────────────────────────────────────────────────────────┤
│ 1. 加载系统树 → 2. 加载API列表 → 3. 初始化筛选条件           │
│        ↓              ↓              ↓                     │
│ 获取系统列表并    获取默认的      设置默认筛选参数            │
│ 构建树形结构      API列表数据                              │
│        ↓                                                    │
│ 4. 状态同步 (同步URL参数和页面状态)                          │
└─────────────────────────────────────────────────────────────┘
```

### 页面初始化
1. **加载系统树**: 获取系统列表并构建树形结构
2. **加载API列表**: 获取默认的API列表数据
3. **初始化筛选条件**: 设置默认筛选参数
4. **状态同步**: 同步URL参数和页面状态

### API搜索与筛选

```
API搜索与筛选流程图
┌─────────────────────────────────────────────────────────────┐
│                   API搜索与筛选系统                          │
├─────────────────────────────────────────────────────────────┤
│ 搜索输入框 → 防抖处理 → 模糊匹配 → 更新API列表              │
│     ↓           ↓         ↓          ↓                     │
│ 关键词输入   延迟300ms   名称/路径/   实时显示结果            │
│             避免频繁     描述匹配                           │
│             请求                                            │
├─────────────────────────────────────────────────────────────┤
│ 筛选条件组合:                                               │
│ [状态筛选] + [方法筛选] + [系统/模块筛选] → [组合查询]       │
│     ↓            ↓            ↓              ↓             │
│ 全部/启用/禁用  GET/POST/等   左侧树选择    URL参数同步      │
└─────────────────────────────────────────────────────────────┘
```

1. **实时搜索**:
   - 用户输入关键词
   - 300ms防抖延迟
   - 自动触发搜索请求
   - 更新API列表

2. **条件筛选**:
   - 选择HTTP方法（GET、POST、PUT、DELETE等）
   - 选择状态（启用、禁用、开发中等）
   - 选择分类或模块
   - 选择时间范围
   - 组合筛选条件

3. **筛选重置**:
   - 点击重置按钮
   - 清空所有筛选条件
   - 恢复默认列表

### API操作流程

#### 新增API
1. **触发操作**: 点击"新增API"按钮
2. **打开表单**: 弹出API创建对话框
   - 注：对话框字段与校验详见 [API表单对话框详细说明](#api表单对话框详细说明)
3. **表单填写**:
   - 基本信息：名称、路径、HTTP方法
   - 详细信息：描述、分类、标签
   - 请求参数：Headers、Query、Body
   - 响应信息：状态码、响应体结构
4. **数据验证**: 实时验证表单数据
5. **提交保存**: 发送创建请求
6. **结果反馈**: 显示成功/失败消息
7. **列表更新**: 刷新API列表

##### API表单对话框详细说明

**对话框组件**: `ApiFormDialog.vue`

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        🔧 API 创建/编辑 - 详细表单视图                       │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─ 步骤导航菜单 ───────────────────────────────────────────────────────────┐ │
│ │ ● 基本信息 ✓    ○ 请求参数    ○ 响应配置    ○ 标签与认证               │ │
│ │ ────────────    ────────────    ────────────    ────────────               │ │
│ │                                                   完成度: ████▒▒ 67%     │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ▼ 基本信息配置 ✓ 已完成                                                     │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │ API名称 *     [用户登录接口                           ] 🔍              │ │
│ │ 请求方法 *    [POST ▼] [GET] [PUT] [DELETE] [PATCH] [OPTIONS]           │ │
│ │ URL路径 *     [http://localhost:8002][/api/v1/login] [🔍 解析GET参数]   │ │
│ │ 所属系统 *    [用户管理系统 ▼]                      [🔄 刷新系统列表]    │ │
│ │ 所属模块 *    [用户认证模块 ▼]                      [➕ 新建模块]        │ │
│ │ API描述       [................................................................] │ │
│ │               [用户登录验证接口，支持用户名/邮箱/手机号多种方式登录      ] │ │
│ │               [支持记住登录状态，提供JWT令牌认证                        ] │ │
│ │ 接口状态      ● 启用  ○ 禁用  ○ 开发中  ○ 已废弃                       │ │
│ │ 认证要求      ○ 需要认证  ● 公开访问  ○ 管理员权限                      │ │
│ │ 版本控制      [v1.0] [📋 版本历史] [🏷️ 创建新版本]                      │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ▼ 请求参数配置 (当前: 3个参数) 🔄                                           │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │ 编辑模式: [📋 表格模式] [📝 JSON模式]  [🔄 切换视图]                    │ │
│ │ 操作工具: [📄 JSON导入] [📋 Excel导出] [🧪 生成示例] [📋 复制参数]      │ │
│ │                                                                         │ │
│ │ ┌─ 参数表格编辑器 ─────────────────────────────────────────────────────┐ │ │
│ │ │ [+ 添加参数] [🗑️ 清空所有] [📋 从模板导入] [🔍 搜索参数]            │ │ │
│ │ │ ┌─────────┬────────┬──────┬─────────────────┬─────────────────────┐ │ │ │
│ │ │ │ 参数名  │ 类型   │ 必填 │ 默认值          │ 描述 / 操作         │ │ │ │
│ │ │ ├─────────┼────────┼──────┼─────────────────┼─────────────────────┤ │ │ │
│ │ │ │username │string  │ ✓    │ -               │用户名 [✏️][🗑️][📋] │ │ │ │
│ │ │ │password │string  │ ✓    │ -               │密码   [✏️][🗑️][👁️] │ │ │ │
│ │ │ │remember │boolean │ ○    │ false           │记住我 [✏️][🗑️][ℹ️] │ │ │ │
│ │ │ │captcha  │string  │ ○    │ -               │验证码 [✏️][🗑️][🔄] │ │ │ │
│ │ │ └─────────┴────────┴──────┴─────────────────┴─────────────────────┘ │ │ │
│ │ │                                                                     │ │ │

│ │ └─────────────────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ▼ 响应配置 (当前: 5个字段) 📊                                               │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │ 编辑模式: [📋 表格模式] [📝 JSON模式]  [🔄 切换视图]                    │ │
│ │ 操作工具: [📄 JSON导入] [📋 Excel导出] [🧪 生成Mock] [📋 复制结构]      │ │
│ │                                                                         │ │
│ │ ┌─ 响应字段表格编辑器 ─────────────────────────────────────────────────┐ │ │
│ │ │ [+ 添加字段] [🗑️ 清空所有] [📋 从模板导入] [🔍 搜索字段]            │ │ │
│ │ │ ┌─────────┬────────┬──────┬─────────────────┬─────────────────────┐ │ │ │
│ │ │ │ 字段名  │ 类型   │ 必返 │ 示例值          │ 描述 / 操作         │ │ │ │
│ │ │ ├─────────┼────────┼──────┼─────────────────┼─────────────────────┤ │ │ │
│ │ │ │code     │number  │ ✓    │ 200             │状态码 [✏️][🗑️][📋] │ │ │ │
│ │ │ │message  │string  │ ✓    │ "登录成功"      │消息   [✏️][🗑️][ℹ️] │ │ │ │
│ │ │ │data     │object  │ ✓    │ {...}           │数据   [✏️][🗑️][📂] │ │ │ │
│ │ │ │├─token  │string  │ ✓    │ "eyJhbGc..."    │令牌   [✏️][🗑️][🔐] │ │ │ │
│ │ │ │├─user   │object  │ ✓    │ {...}           │用户   [✏️][🗑️][👤] │ │ │ │
│ │ │ ││ ├─id   │number  │ ✓    │ 12345           │用户ID [✏️][🗑️][🔢] │ │ │ │
│ │ │ ││ ├─name │string  │ ✓    │ "张三"          │姓名   [✏️][🗑️][📝] │ │ │ │
│ │ │ ││ └─role │string  │ ○    │ "user"          │角色   [✏️][🗑️][🏷️] │ │ │ │
│ │ │ │└─expire │number  │ ✓    │ 1640995200      │过期时间[✏️][🗑️][⏰] │ │ │ │
│ │ │ └─────────┴────────┴──────┴─────────────────┴─────────────────────┘ │ │ │
│ │ │                                                                     │ │ │
│ │ │ 📊 响应状态码配置:                                                  │ │ │
│ │ │ • 200: 登录成功  • 400: 参数错误  • 401: 认证失败  • 500: 服务错误  │ │ │ │
│ │ └─────────────────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│ ▼ 标签管理                                                                  │
│ ┌─────────────────────────────────────────────────────────────────────────┐ │
│ │ 标签: [用户管理 ×] [登录认证 ×] [+ 添加标签...]                         │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─ 对话框底部操作区 ───────────────────────────────────────────────────────┐ │
│ │                                                    [取消] [保存]        │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

🎯 详细功能说明:
• 📝 智能表单验证: 实时验证字段格式、长度、必填项等
• 🔄 数据联动: 系统选择自动加载模块，参数类型自动推荐验证规则
• 📋 模板支持: 提供常用API模板，快速创建标准接口
• 🧪 在线测试: 表单填写完成后可直接测试接口功能
• 💾 草稿保存: 自动保存表单数据，防止意外丢失
• 📊 数据可视化: 参数和响应结构支持树形展示和JSON预览
• 🔐 安全配置: 完整的认证和权限配置选项
• 📱 响应式设计: 适配不同屏幕尺寸，移动端友好
```

**表单字段结构**:

**导航与进度**:
- **导航菜单**: 四个步骤 - 基本信息、请求参数、响应配置、标签与认证
- **进度指示器**: 实时显示表单完成度百分比
- **面板状态**: 每个面板显示完成状态和配置数量

**基本信息面板**:
- **API名称** (必填): 文本输入框，最大长度100字符
- **请求方法** (必填): 下拉选择框，支持GET、POST、PUT、DELETE、PATCH等
- **URL路径** (必填): 
  - 基础URL显示 (如: http://localhost:8002)
  - 路径输入框 (必须以/开头)
  - "解析GET参数"按钮 - 自动从URL解析查询参数
    - 示例：`/api/interfaces?system_id=10&enabled_only=false` → 生成两个参数并保留路径 `/api/interfaces`
- **所属系统** (必填): 下拉选择框，选择后自动加载对应模块
- **所属模块**: 下拉选择框，依赖于所属系统的选择
- **API描述**: 多行文本框，最大500字符，支持字数统计
- **状态开关**: 启用/禁用 切换开关
- **认证开关**: 需要认证/公开访问 切换开关
  - 选中时：调用时需要传递认证Token或Session
  - 未选中时：公开API，无需认证即可访问

**请求参数面板** (可选):
   - **模式切换**: [📋 表格模式] [📝 JSON模式]
   - **操作按钮**: [📄 JSON导入] [📋 导出] [+ 添加参数] [清空所有]
   - **表格模式**:
     - 参数名称、类型、是否必填、描述
     - 支持嵌套参数（对象类型可展开子参数）
     - 行内编辑，实时验证
     - 支持无限层级的嵌套结构
   - **JSON模式**:
     - 代码编辑器，支持语法高亮
     - 实时JSON格式验证
     - 一键转换为表格模式
   - **JSON导入导出**:
     - 支持从JSON文件导入参数配置
     - 导出当前参数配置为JSON格式
     - 格式验证和错误提示
   - **GET参数自动解析**:
     - 当请求方法为GET时，从URL自动解析查询参数
     - 支持复杂查询串解析

**响应配置面板** (可选):
   - **模式切换**: [📋 表格模式] [📝 JSON模式]
   - **操作按钮**: [📄 JSON导入] [📋 导出] [+ 添加字段] [清空所有]
   - **表格模式**:
     - 字段名、类型、是否必返、描述
     - 支持嵌套响应字段
     - 可视化层级结构展示
   - **JSON模式**:
     - JSON Schema编辑器
     - 实时预览响应结构
     - 支持复杂响应格式定义
   - **JSON Schema支持**:
     - 自动生成JSON Schema
     - 从JSON Schema转换为表格
     - 响应验证规则定义

**标签与认证面板** (可选):
   - **标签管理**:
     - 已选标签显示，支持快速删除
     - 多选下拉框，支持搜索
     - 支持创建新标签
     - 预定义标签快速选择

**表单验证规则**:
- **必填字段验证**: API名称、请求方法、URL路径、所属系统
- **格式验证**: URL路径必须以 `/` 开头，符合RESTful规范
- **长度限制**: API名称最大100字符，描述最大500字符
- **重复性检验**: 同一系统下API名称不能重复
- **依赖验证**: 选择模块前必须先选择系统
- **JSON格式验证**: JSON模式下的参数和响应配置格式校验

**交互特性**:
- **导航式界面**: 四步骤导航，支持点击跳转到任意步骤
- **实时进度**: 动态计算并显示表单完成度百分比
- **面板状态**: 每个面板显示配置状态和数量统计
- **实时验证**: 字段失焦时立即验证，错误信息实时显示
- **动态依赖**: 系统选择变化时自动更新模块列表
- **参数管理**: 支持参数的增删改查，嵌套结构管理
- **模式切换**: 表格模式和JSON模式无缝切换
- **JSON导入导出**: 支持批量配置导入导出
- **标签创建**: 支持在选择过程中快速创建新标签
- **GET参数解析**: 自动从URL解析查询参数到参数表
- **保存状态**: 表单数据自动保存到本地，防止意外丢失
- **错误处理**: 网络错误、验证失败等异常情况的友好提示

**界面优化特性**:
- **模块分隔**: 各配置区域采用可折叠面板设计，减少视觉干扰
  - 基本信息: 默认展开，包含必填的核心字段
  - 请求参数: 可折叠，支持快速预览参数数量
  - 响应配置: 可折叠，显示已配置的状态码数量
  - 标签管理: 可折叠，显示已选标签预览
- **折叠状态记忆**: 用户的折叠偏好会被保存，下次打开时恢复
- **快速导航**: 左侧提供锚点导航，快速跳转到指定配置区域
- **进度指示**: 顶部显示配置完成度进度条
- **内容预览**: 折叠状态下显示关键信息摘要

**UI优化特性**:
- **可折叠面板**: 每个配置面板支持展开/折叠
- **状态记忆**: 记住用户的面板展开/折叠状态
- **快速导航**: 支持Tab键快速切换字段焦点
- **进度指示**: 实时显示表单完成进度，引导用户填写
- **内容预览**: 在保存前预览API配置的最终效果
- **响应式布局**: 适配不同屏幕尺寸的设备
- **操作反馈**: 按钮状态、加载指示器等交互反馈

#### 编辑API
1. **触发操作**: 点击API卡片的"编辑"按钮
2. **加载数据**: 获取API详细信息
3. **填充表单**: 预填充现有数据
4. **修改数据**: 用户编辑相关字段
5. **保存更新**: 提交修改请求
6. **状态更新**: 更新列表中的API信息

**编辑模式特性**:
- **表单复用**: 使用与新增相同的`ApiFormDialog`组件
- **数据预填充**: 自动填充API的现有信息到表单各字段
- **字段限制**: 某些关键字段(如所属系统)在编辑模式下可能被禁用
- **增量更新**: 只提交发生变化的字段数据
- **版本控制**: 支持并发编辑检测，防止数据覆盖
- **保存状态管理**: 编辑保存后正确重置组件状态，支持连续编辑操作

#### 删除API
1. **触发操作**: 点击"删除"按钮
2. **确认对话框**: 显示删除确认提示
3. **执行删除**: 发送删除请求
4. **列表更新**: 从列表中移除已删除项
5. **消息提示**: 显示删除成功消息

#### API测试 (增强版)

```
API测试流程图
┌─────────────────────────────────────────────────────────────┐
│                      API测试完整流程                        │
├─────────────────────────────────────────────────────────────┤
│ 1. 测试入口 → 2. 界面加载 → 3. 参数配置 → 4. 环境选择       │
│     ↓            ↓            ↓            ↓               │
│ 点击测试按钮   打开测试抽屉   自动加载参数   选择测试环境     │
│                              定义                          │
│     ↓                                                      │
│ 5. 发送请求 → 6. 结果展示 → 7. 历史记录                    │
│     ↓            ↓            ↓                           │
│ 执行API调用    响应数据展示   保存测试记录                  │
└─────────────────────────────────────────────────────────────┘
```

1. **触发操作**: 点击"测试"按钮或从API表单"调试"
2. **打开测试面板**: 右侧抽屉式测试界面，支持全屏模式
3. **测试环境配置**:
   - **环境选择**: 开发/测试/预发布环境切换
   - **基础URL**: 自动根据环境加载对应的服务地址
   - **认证配置**: 
     - Token认证: Bearer Token输入框
     - Session认证: Cookie/Session配置
     - 无认证: 公开API直接测试

4. **请求参数配置** (智能化):
   - **自动填充**: 根据API定义自动生成测试数据模板
   - **参数类型适配**:
     - Headers: 键值对编辑器，支持常用Header预设
     - Query参数: 表格形式，支持数组参数
     - Body参数: 
       - JSON编辑器(语法高亮、格式化)
       - Form表单(文件上传支持)
       - Raw文本(支持XML、Plain Text等)
   - **数据生成器**: 
     - Mock数据: 根据字段类型生成随机测试数据
     - 历史数据: 复用之前的测试参数
     - 模板数据: 预设的常用测试场景

5. **发送请求与监控**:
   - **请求发送**: 支持单次请求和批量测试
   - **实时监控**: 
     - 请求状态: 发送中/成功/失败/超时
     - 响应时间: 毫秒级精度显示
     - 数据大小: 请求/响应体大小统计
   - **并发测试**: 支持设置并发数量进行压力测试

6. **结果展示与分析**:
   - **响应详情**:
     ```
     ┌─────────── 响应结果 ───────────┐
     │ 状态码: 200 OK    耗时: 245ms  │
     │ 大小: 1.2KB      时间: 14:30   │
     ├───────────────────────────────┤
     │ Headers:                      │
     │ Content-Type: application/json│
     │ Content-Length: 1234          │
     ├───────────────────────────────┤
     │ Response Body: (格式化JSON)    │
     │ {                             │
     │   "code": 0,                  │
     │   "message": "success",       │
     │   "data": { ... }             │
     │ }                             │
     ├───────────────────────────────┤
     │ [📋复制] [💾保存] [📊分析]     │
     └───────────────────────────────┘
     ```
   - **成功指示器**: 
     - ✅ 绿色: 2xx状态码，响应正常
     - ⚠️ 黄色: 3xx重定向，需要注意
     - ❌ 红色: 4xx/5xx错误，请求失败
   - **响应验证**: 
     - 状态码验证: 检查是否符合预期
     - 响应结构验证: 对比API定义的响应格式
     - 字段值验证: 检查关键字段的数据类型和取值范围

7. **测试用例管理**:
   - **保存测试用例**: 
     - 用例名称: 自定义测试场景名称
     - 参数快照: 保存当前的所有请求参数
     - 预期结果: 设置期望的响应状态和数据
   - **用例执行**: 
     - 快速执行: 一键运行保存的测试用例
     - 批量执行: 同时运行多个测试用例
     - 定时执行: 设置定期自动测试
   - **结果对比**: 
     - 历史对比: 与之前的测试结果进行对比
     - 基准对比: 与预设的基准数据进行验证
     - 差异高亮: 突出显示响应数据的变化

8. **测试报告与导出**:
   - **测试报告**: 
     - 成功率统计: 显示测试通过率
     - 性能指标: 平均响应时间、最大/最小耗时
     - 错误汇总: 统计各类错误的出现频次
   - **数据导出**: 
     - 导出格式: JSON/Excel/PDF报告
     - 包含内容: 请求参数、响应数据、测试结果
     - 分享功能: 生成测试报告链接供团队查看

### 批量操作

```
批量操作流程图
┌─────────────────────────────────────────────────────────────┐
│                      批量操作系统                            │
├─────────────────────────────────────────────────────────────┤
│ 1. 选择API → 2. 选择操作 → 3. 确认操作 → 4. 执行操作        │
│     ↓            ↓            ↓            ↓               │
│ 复选框多选    批量删除/启用   显示影响范围   后台处理         │
│              /禁用/导出                                     │
│              /标签管理                                      │
├─────────────────────────────────────────────────────────────┤
│ 支持的批量操作:                                             │
│ • 批量删除     • 批量启用/禁用                              │
│ • 批量导出     • 批量标签管理                               │
│ • 批量移动     • 批量复制                                   │
└─────────────────────────────────────────────────────────────┘
```

1. **选择API**: 勾选多个API项目
2. **选择操作**: 从批量操作菜单选择
3. **确认执行**: 显示批量操作确认对话框
4. **执行操作**: 并行处理选中的API
5. **进度显示**: 显示批量操作进度
6. **结果汇总**: 展示操作结果统计

### 导入导出功能

```
导入导出功能流程图
┌─────────────────────────────────────────────────────────────┐
│                    导入导出功能系统                          │
├─────────────────────────────────────────────────────────────┤
│ 导入流程:                                                   │
│ 选择文件 → 预览数据 → 冲突处理 → 执行导入 → 结果反馈        │
│     ↓         ↓         ↓         ↓         ↓             │
│ JSON/YAML/   显示API   重复API    批量创建   成功/失败       │
│ Postman      列表      处理策略   API       统计           │
├─────────────────────────────────────────────────────────────┤
│ 导出流程:                                                   │
│ 选择范围 → 选择格式 → 配置选项 → 生成文件                   │
│     ↓         ↓         ↓         ↓                       │
│ 全部/选中   JSON/YAML/  敏感信息   下载文件                 │
│ API        Postman     /测试数据                           │
└─────────────────────────────────────────────────────────────┘
```

#### 导入API
1. **选择文件**: 点击导入按钮，选择文件
2. **格式验证**: 验证文件格式（JSON、Excel等）
3. **数据预览**: 显示导入数据预览
4. **冲突处理**: 处理重复API的策略选择
5. **执行导入**: 批量创建API
6. **结果报告**: 显示导入成功/失败统计

#### 导出API
1. **选择范围**: 选择导出的API范围
2. **选择格式**: 选择导出格式（JSON、Excel、CSV）
3. **配置选项**: 设置导出字段和格式
4. **生成文件**: 创建导出文件
5. **下载文件**: 提供文件下载链接

## 页面弹框与抽屉

本页面中的所有弹框/抽屉均归属于本页面文档，不单独成文；如为跨页复用的通用弹框，会在本页完整描述，同时在共享组件文档登记并建立互链。下列弹框/抽屉按出现频率与重要性集中说明：

### API表单对话框（新增/编辑）

```
API表单对话框组件结构图
┌─────────────────────────────────────────────────────────────────────────────┐
│                           🔧 API创建/编辑对话框                              │
│                              ApiFormDialog.vue                             │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─ 对话框头部 ─────────────────────────────────────────────────────────────┐ │
│ │ 📝 新增API接口                                    进度: ████▒▒ 67%  [×] │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─ 步骤导航标签页 ─────────────────────────────────────────────────────────┐ │
│ │ ● 基本信息 ✓    ○ 请求参数    ○ 响应配置    ○ 标签与认证               │ │
│ │ ────────────    ────────────    ────────────    ────────────               │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─ 表单内容区域 ───────────────────────────────────────────────────────────┐ │
│ │                                                                         │ │
│ │ ▼ 基本信息配置                                                          │ │
│ │ ┌─────────────────────────────────────────────────────────────────────┐ │ │
│ │ │ API名称 *    [用户登录接口                    ]                     │ │ │
│ │ │ 请求方法 *   [POST ▼] [GET] [PUT] [DELETE] [PATCH]                 │ │ │
│ │ │ URL路径 *    [http://localhost:8002][/api/v1/login] [🔍解析GET参数] │ │ │
│ │ │ 所属系统 *   [用户管理系统 ▼]                                       │ │ │
│ │ │ 所属模块 *   [用户认证模块 ▼]                                       │ │ │
│ │ │ API描述      [................................................................] │ │ │
│ │ │              [用户登录验证接口，支持用户名/邮箱/手机号登录            ] │ │ │
│ │ │ 接口状态     ● 启用  ○ 禁用  ○ 开发中                              │ │ │
│ │ │ 认证要求     ○ 需要认证  ● 公开访问                                │ │ │
│ │ └─────────────────────────────────────────────────────────────────────┘ │ │
│ │                                                                         │ │
│ │ ▼ 请求参数配置 (当前: 3个参数)                                          │ │
│ │ ┌─────────────────────────────────────────────────────────────────────┐ │ │
│ │ │ 编辑模式: [📋 表格模式] [📝 JSON模式]  操作: [📄 导入] [📋 导出]    │ │ │
│ │ │ ┌─ 参数表格 ─────────────────────────────────────────────────────┐ │ │ │
│ │ │ │ [+ 添加参数] [🗑️ 清空] [📋 从示例导入]                        │ │ │ │
│ │ │ │ ┌─────────┬────────┬──────┬─────────────────┬──────────────┐ │ │ │ │
│ │ │ │ │ 参数名  │ 类型   │ 必填 │ 默认值          │ 描述/操作    │ │ │ │ │
│ │ │ │ ├─────────┼────────┼──────┼─────────────────┼──────────────┤ │ │ │ │
│ │ │ │ │username │string  │ ✓    │ -               │用户名 [✏️][🗑️]│ │ │ │ │
│ │ │ │ │password │string  │ ✓    │ -               │密码   [✏️][🗑️]│ │ │ │ │
│ │ │ │ │remember │boolean │ ○    │ false           │记住我 [✏️][🗑️]│ │ │ │ │
│ │ │ │ └─────────┴────────┴──────┴─────────────────┴──────────────┘ │ │ │ │
│ │ │ └───────────────────────────────────────────────────────────┘ │ │ │
│ │ └─────────────────────────────────────────────────────────────────────┘ │ │
│ │                                                                         │ │
│ │ ▼ 响应配置 (当前: 5个字段)                                              │ │
│ │ ┌─────────────────────────────────────────────────────────────────────┐ │ │
│ │ │ 编辑模式: [📋 表格模式] [📝 JSON模式]  操作: [📄 导入] [📋 导出]    │ │ │
│ │ │ ┌─ 响应字段表格 ─────────────────────────────────────────────────┐ │ │ │
│ │ │ │ [+ 添加字段] [🗑️ 清空] [📋 从示例导入]                        │ │ │ │
│ │ │ │ ┌─────────┬────────┬──────┬─────────────────┬──────────────┐ │ │ │ │
│ │ │ │ │ 字段名  │ 类型   │ 必返 │ 示例值          │ 描述/操作    │ │ │ │ │
│ │ │ │ ├─────────┼────────┼──────┼─────────────────┼──────────────┤ │ │ │ │
│ │ │ │ │code     │number  │ ✓    │ 200             │状态码 [✏️][🗑️]│ │ │ │ │
│ │ │ │ │message  │string  │ ✓    │ "登录成功"      │消息   [✏️][🗑️]│ │ │ │ │
│ │ │ │ │data     │object  │ ✓    │ {...}           │数据   [✏️][🗑️]│ │ │ │ │
│ │ │ │ │├─token  │string  │ ✓    │ "eyJ..."        │令牌   [✏️][🗑️]│ │ │ │ │
│ │ │ │ │└─user   │object  │ ✓    │ {...}           │用户   [✏️][🗑️]│ │ │ │ │
│ │ │ │ └─────────┴────────┴──────┴─────────────────┴──────────────┘ │ │ │ │
│ │ │ └───────────────────────────────────────────────────────────┘ │ │ │
│ │ └─────────────────────────────────────────────────────────────────────┘ │ │
│ │                                                                         │ │
│ │ ▼ 标签管理                                                              │ │
│ │ ┌─────────────────────────────────────────────────────────────────────┐ │ │
│ │ │ 标签: [用户管理 ×] [登录认证 ×] [+ 添加标签...]                     │ │ │
│ │ └─────────────────────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─ 对话框底部操作区 ───────────────────────────────────────────────────────┐ │
│ │                                                    [取消] [保存]        │ │
│ └─────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘

🎯 组件特性说明：
• 📋 折叠面板表单：分为4个折叠面板，支持展开/收起切换
• 🔄 双模式编辑：参数和响应支持表格/JSON两种编辑模式无缝切换
• 🔗 智能联动：系统选择后自动加载对应模块列表，支持级联选择
• ⚡ 实时校验：字段输入时进行即时验证和错误提示，提升用户体验
• 🏷️ 标签管理：支持多选标签，可创建新标签
```

- 触发入口：新增API按钮；列表项"编辑"按钮
- 组件：`ApiFormDialog.vue`
- 字段与校验：详见"交互流程 → 新增API"中的【API表单对话框详细说明】
- 提交逻辑：保存时显示loading，禁用重复提交；成功后刷新列表并关闭对话框
- 事件与契约：`onSubmit(payload)`、`onCancel()`、`onValidateError(errors)`
- 自测清单：必填校验、依赖联动（系统→模块）、重复参数校验、保存失败重试

### 删除确认对话框

```
删除确认对话框组件结构图
┌─────────────────────────────────────────────────────────────┐
│                   DeleteConfirmDialog.vue                   │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框头部 ─────────────────────────────────────────────┐ │
│ │ [⚠️] 删除确认                                [×]        │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 警告信息区域 ───────────────────────────────────────────┐ │
│ │ ⚠️ 您即将删除以下API，此操作不可撤销：                   │ │
│ │                                                         │ │
│ │ • 用户登录 (POST /api/v1/login)                         │ │
│ │ • 获取用户信息 (GET /api/v1/user)                       │ │
│ │ • 创建订单 (POST /api/v1/order)                         │ │
│ │ ... 共3个API                                            │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 风险提示区域 ───────────────────────────────────────────┐ │
│ │ 🔥 高风险操作确认                                       │ │
│ │ 请输入 "DELETE" 以确认删除操作：                        │ │
│ │ [________________]                                      │ │
│ │ ✓ 我已了解删除后果，确认执行此操作                       │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 影响范围提示 ───────────────────────────────────────────┐ │
│ │ 📊 删除影响分析：                                       │ │
│ │ • 关联的测试场景：5个                                   │ │
│ │ • 关联的工作流：2个                                     │ │
│ │ • 历史调用记录：将被保留                                │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框底部 ─────────────────────────────────────────────┐ │
│ │                    [取消] [确认删除]                     │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

组件特性：
• 安全确认：多重确认机制，防止误删除操作
• 详细展示：显示待删除API的完整信息列表
• 风险评估：展示删除操作的影响范围和后果
• 关键字确认：高风险操作需要输入确认关键字
• 智能禁用：未完成确认步骤时禁用删除按钮
```

- 触发入口：列表项"删除"按钮；批量操作"删除所选"
- 文案：二次确认，展示API名称/数量；高风险操作需输入确认关键字（可选）
- 提交逻辑：确认后调用删除接口；进度与结果Toast提示
- 事件与契约：`onConfirm(ids)`、`onCancel()`、`onFinish(summary)`
- 自测清单：单条删除、批量删除、权限不足、网络失败回退

### 批量操作确认对话框

```
批量操作确认对话框组件结构图
┌─────────────────────────────────────────────────────────────┐
│                BatchOperationDialog.vue                     │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框头部 ─────────────────────────────────────────────┐ │
│ │ [📋] 批量操作确认                            [×]        │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 操作类型选择 ───────────────────────────────────────────┐ │
│ │ 选择操作类型：                                          │ │
│ │ ○ 批量启用    ○ 批量禁用    ○ 批量删除                  │ │
│ │ ○ 批量导出    ○ 批量移动    ○ 标签管理                  │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 选中项统计 ─────────────────────────────────────────────┐ │
│ │ 📊 已选中 15 个API：                                    │ │
│ │ • 可执行操作：12个                                      │ │
│ │ • 权限不足：2个                                         │ │
│ │ • 状态冲突：1个                                         │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 预检查结果 ─────────────────────────────────────────────┐ │
│ │ ✅ 预检查通过的API (12个)：                             │ │
│ │ • 用户登录 (POST /api/v1/login)                         │ │
│ │ • 获取用户信息 (GET /api/v1/user)                       │ │
│ │ • 创建订单 (POST /api/v1/order)                         │ │
│ │ ... 显示更多                                            │ │
│ │                                                         │ │
│ │ ⚠️ 无法执行的API (3个)：                                │ │
│ │ • 支付接口 - 权限不足                                   │ │
│ │ • 退款接口 - 状态冲突                                   │ │
│ │ • 查询接口 - 权限不足                                   │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 操作配置区域 ───────────────────────────────────────────┐ │
│ │ 目标系统：[订单系统 ▾]                                  │ │
│ │ 目标模块：[订单管理 ▾]                                  │ │
│ │ 添加标签：[重要接口] [+ 添加]                           │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框底部 ─────────────────────────────────────────────┐ │
│ │ [取消]  [重新检查]                    [执行操作(12)] │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘

组件特性：
• 智能预检查：自动检查每个API的操作可行性
• 分类展示：区分可执行和不可执行的API项目
• 动态配置：根据操作类型显示相应的配置选项
• 实时统计：显示选中项数量和操作影响范围
• 权限验证：检查用户对每个API的操作权限
• 状态检查：验证API当前状态是否支持目标操作
```

- 触发入口：顶部"批量操作"菜单
- 能力：展示选中项数量与操作影响范围，支持预检查与模拟（如可删除/不可删除数量）
- 事件与契约：`onPrecheck(ids)`、`onConfirm(action, ids)`、`onCancel()`
- 自测清单：0项禁用、N项正常、部分失败反馈

### 导入预览对话框

```
组件结构图 - 导入预览对话框
┌─────────────────────────────────────────────────────────────┐
│                ImportPreviewDialog.vue                     │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框头部 ─────────────────────────────────────────────┐ │
│ │ [📁] 导入API数据                             [×]        │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 文件选择区域 ───────────────────────────────────────────┐ │
│ │ 📎 选择文件：                                           │ │
│ │ ┌─────────────────────────────┐ [浏览文件]              │ │
│ │ │ 拖拽文件到此处或点击选择     │                         │ │
│ │ │ 支持格式：.json, .yaml, .csv │                         │ │
│ │ └─────────────────────────────┘                         │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 格式校验结果 ───────────────────────────────────────────┐ │
│ │ ✅ 文件格式校验通过                                     │ │
│ │ 📊 检测到 25 个API定义                                  │ │
│ │ • 有效记录：23个                                        │ │
│ │ • 格式错误：2个                                         │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 数据预览区域 ───────────────────────────────────────────┐ │
│ │ 📋 数据预览 (前10条)：                                  │ │
│ │ ┌─────────────────────────────────────────────────────┐ │ │
│ │ │ API名称    │ 方法  │ 路径        │ 状态  │ 冲突   │ │ │
│ │ ├─────────────────────────────────────────────────────┤ │ │
│ │ │ 用户登录   │ POST  │ /api/login  │ 新增  │ 无     │ │ │
│ │ │ 获取用户   │ GET   │ /api/user   │ 冲突  │ 覆盖   │ │ │
│ │ │ ...        │ ...   │ ...         │ ...   │ ...    │ │ │
│ │ └─────────────────────────────────────────────────────┘ │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 冲突策略配置 ───────────────────────────────────────────┐ │
│ │ ⚙️ 冲突处理策略：                                       │ │
│ │ ○ 覆盖现有API    ○ 跳过冲突项    ○ 创建副本            │ │
│ │ 📝 字段映射配置：                                       │ │
│ │ • 名称映射：[源字段] → [目标字段]                       │ │
│ │ • 标签映射：[源标签] → [目标标签]                       │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框底部 ─────────────────────────────────────────────┐ │
│ │                    [取消] [开始导入]                     │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**组件特性说明：**
- **文件上传支持**：拖拽上传、格式验证、多种文件类型支持
- **实时校验**：格式检查、数据统计、错误提示
- **数据预览**：表格展示、冲突标识、状态显示
- **智能映射**：字段映射、标签映射、策略配置
- **冲突处理**：多种策略、智能建议、安全确认

- 触发入口：顶部"导入"按钮
- 功能：文件选择→格式校验→数据预览→冲突策略选择（覆盖/跳过/新建副本）
- 事件与契约：`onFileSelect(file)`、`onValidate(result)`、`onImport(options)`
- 自测清单：格式错误提示、字段映射、冲突策略正确生效

### 导出配置对话框

```
组件结构图 - 导出配置对话框
┌─────────────────────────────────────────────────────────────┐
│                ExportConfigDialog.vue                      │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框头部 ─────────────────────────────────────────────┐ │
│ │ [📤] 导出API数据                             [×]        │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 导出范围选择 ───────────────────────────────────────────┐ │
│ │ 🎯 选择导出范围：                                       │ │
│ │ ○ 全部API (共125个)                                     │ │
│ │ ○ 当前筛选结果 (共23个)                                 │ │
│ │ ○ 选中的API (共8个)                                     │ │
│ │ ○ 自定义范围：                                          │ │
│ │   ┌─────────────────────────────────────────────────┐   │ │
│ │   │ 按标签筛选：[Web] [Mobile] [Internal]          │   │ │
│ │   │ 按状态筛选：☑启用 ☑禁用 ☐草稿                  │   │ │
│ │   └─────────────────────────────────────────────────┘   │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 导出格式配置 ───────────────────────────────────────────┐ │
│ │ 📄 选择导出格式：                                       │ │
│ │ ○ JSON格式 (.json)    ○ YAML格式 (.yaml)               │ │
│ │ ○ CSV格式 (.csv)      ○ Excel格式 (.xlsx)              │ │
│ │ ○ Postman集合 (.json) ○ OpenAPI规范 (.yaml)            │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 字段选择配置 ───────────────────────────────────────────┐ │
│ │ ☑ 全选/反选                                             │ │
│ │ ┌─ 基本信息 ─────────────────────────────────────────┐   │ │
│ │ │ ☑ API名称    ☑ 请求方法    ☑ 请求路径              │   │ │
│ │ │ ☑ API描述    ☑ 创建时间    ☑ 更新时间              │   │ │
│ │ └─────────────────────────────────────────────────────┘   │ │
│ │ ┌─ 详细配置 ─────────────────────────────────────────┐   │ │
│ │ │ ☑ 请求参数    ☑ 响应配置    ☑ 认证信息            │   │ │
│ │ │ ☑ 标签信息    ☐ 测试用例    ☐ 历史记录            │   │ │
│ │ └─────────────────────────────────────────────────────┘   │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 导出预览 ───────────────────────────────────────────────┐ │
│ │ 📊 导出预览：                                           │ │
│ │ • 导出范围：选中的API (8个)                             │ │
│ │ • 导出格式：JSON格式                                    │ │
│ │ • 包含字段：基本信息 + 请求参数 + 响应配置              │ │
│ │ • 预计文件大小：约 2.5MB                                │ │
│ └─────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────┤
│ ┌─ 对话框底部 ─────────────────────────────────────────────┐ │
│ │                    [取消] [开始导出]                     │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**组件特性说明：**
- **灵活范围选择**：全部、筛选结果、选中项、自定义范围
- **多格式支持**：JSON、YAML、CSV、Excel、Postman、OpenAPI
- **字段自定义**：分组选择、全选反选、预览统计
- **智能预览**：范围统计、格式显示、大小预估
- **任务管理**：后台导出、进度跟踪、下载链接

- 触发入口：顶部"导出"按钮
- 功能：选择范围/格式/字段；生成任务并反馈下载链接
- 事件与契约：`onExport(options)`、`onCancel()`
- 自测清单：空范围提示、字段勾选、生成文件校验



## 响应式设计

```
响应式布局适配图
┌─────────────────────────────────────────────────────────────┐
│                      响应式设计系统                          │
├─────────────────────────────────────────────────────────────┤
│ 桌面端 (>1200px):                                           │
│ ┌─────────────┬─────────────────────────────────────────┐   │
│ │ 左侧导航    │ 右侧API管理面板                         │   │
│ │ 固定280px   │ 自适应剩余空间                          │   │
│ │             │ [API表格] 完整显示所有列                │   │
│ │             │ [操作按钮] 完整显示                     │   │
│ └─────────────┴─────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────────┤
│ 平板端 (768px-1200px):                                      │
│ ┌───┬─────────────────────────────────────────────────┐     │
│ │☰ │ 右侧API管理面板                                 │     │
│ │   │ [API表格] 隐藏次要列                            │     │
│ │   │ [操作按钮] 收缩到下拉菜单                       │     │
│ └───┴─────────────────────────────────────────────────┘     │
├─────────────────────────────────────────────────────────────┤
│ 移动端 (<768px):                                            │
│ ┌─────────────────────────────────────────────────────┐     │
│ │ [☰] 搜索筛选区域 (垂直排列)                         │     │
│ │ ┌─────────────────────────────────────────────────┐ │     │
│ │ │ [API卡片布局] 替代表格                          │ │     │
│ │ │ [操作按钮] 简化为图标                           │ │     │
│ │ └─────────────────────────────────────────────────┘ │     │
│ └─────────────────────────────────────────────────────┘     │
└─────────────────────────────────────────────────────────────┘
```

### 桌面端 (>1200px)
- 左侧导航固定宽度 280px
- 右侧内容区域自适应
- API表格完整显示所有列
- 完整显示所有操作按钮

### 平板端 (768px-1200px)
- 左侧导航可折叠
- API表格隐藏部分次要列（如创建时间）
- 部分操作按钮收缩到下拉菜单

### 移动端 (<768px)
- 左侧导航抽屉式显示
- API表格转为卡片式布局
- 操作按钮简化为图标
- 搜索筛选区域垂直排列

## 键盘快捷键

- `Ctrl/Cmd + N`: 新增API
- `Ctrl/Cmd + F`: 聚焦搜索框
- `Ctrl/Cmd + R`: 刷新列表
- `Escape`: 关闭对话框
- `Enter`: 确认操作
- `Tab`: 在表单字段间切换

## 加载状态和反馈

### 加载状态
- **页面初始化**: 骨架屏显示
- **搜索加载**: 搜索框显示加载图标
- **API操作**: 按钮显示加载状态
- **批量操作**: 进度条显示

### 用户反馈
- **成功操作**: 绿色Toast消息
- **错误处理**: 红色错误提示
- **警告信息**: 橙色警告提示
- **信息提示**: 蓝色信息提示

### 空状态处理
- **无API数据**: 显示空状态插画和引导
- **搜索无结果**: 提供搜索建议
- **网络错误**: 显示重试按钮

## 常见问题与解决方案

### 性能优化
- **虚拟滚动**: 大量API数据时使用虚拟表格
- **分页加载**: 合理设置每页数据量（建议20-50条）
- **表格优化**: 固定表头、列宽自适应
- **缓存策略**: 缓存常用的筛选结果

### 用户体验
- **操作确认**: 重要操作提供二次确认
- **撤销功能**: 支持删除操作的撤销
- **自动保存**: 表单数据自动保存草稿
- **快速操作**: 提供常用操作的快捷方式

### 错误处理
- **网络异常**: 提供重试机制
- **权限不足**: 明确提示权限要求
- **数据冲突**: 提供冲突解决方案
- **表单验证**: 实时验证和错误提示

## 接口调用说明

### 前端API接口

#### 系统管理接口
```javascript
// 获取系统列表
apiManagementApi.getServiceList(params)
// 参数: { keyword?, serviceId?, method? }
// 返回: Promise<ApiResponse>

// 创建系统
apiManagementApi.createService(data)
// 参数: { name, description, url, category, icon, enabled }
// 返回: Promise<ApiResponse>

// 更新系统
apiManagementApi.updateService(systemId, data)
// 参数: systemId (string), data (Partial<ServiceData>)
// 返回: Promise<ApiResponse>

// 删除系统
apiManagementApi.deleteService(systemId)
// 参数: systemId (string)
// 返回: Promise<ApiResponse>
```

#### 模块管理接口
```javascript
// 获取模块列表
apiManagementApi.getModuleList(params)
// 参数: { system_id?, keyword?, method?, status? }
// 返回: Promise<ApiResponse>
```

#### API接口管理
```javascript
// 获取API列表
apiManagementApi.getApis(params)
// 参数: { system_id?, module_id?, enabled_only?, keyword?, method? }
// 返回: Promise<ApiResponse>

// 获取API详情
apiManagementApi.getApiDetail(apiId)
// 参数: apiId (string)
// 返回: Promise<ApiResponse>

// 创建API
apiManagementApi.createApi(data)
// 参数: { system_id, name, description, url, enabled, tags }
// 返回: Promise<ApiResponse>

// 更新API
apiManagementApi.updateApi(apiId, data)
// 参数: apiId (string), data (Partial<ApiData>)
// 返回: Promise<ApiResponse>

// 删除API
apiManagementApi.deleteApi(apiId)
// 参数: apiId (string)
// 返回: Promise<ApiResponse>

// 测试API
apiManagementApi.testApi(apiId, testData)
// 参数: apiId (string), testData (TestData)
// 返回: Promise<ApiResponse>

// 批量测试API
apiManagementApi.batchTestApis(apiIds, testConfig)
// 参数: apiIds (string[]), testConfig (TestConfig)
// 返回: Promise<ApiResponse>
```

#### 统计和工具接口
```javascript
// 获取API统计
apiManagementApi.getApiStatistics()
// 返回: Promise<ApiResponse<ApiStatistics>>

// 获取综合统计
apiManagementApi.getStats()
// 返回: Promise<ApiResponse<StatsData>>

// 导入API
apiManagementApi.importApis(formData)
// 参数: formData (FormData)
// 返回: Promise<ApiResponse>

// 导出API
apiManagementApi.exportApis(params)
// 参数: params (Record<string, any>)
// 返回: Promise<Blob>
```

### 后端API接口

#### API接口管理 (`/api-interfaces/v1/`)

| 方法 | 路径 | 功能 | 参数 |
|------|------|------|------|
| GET | `/api-interfaces/v1/` | 获取API接口列表 | system_id?, module_id?, keyword?, method?, status?, enabled_only?, page?, size? |
| GET | `/api-interfaces/v1/{api_id}` | 获取API接口详情 | api_id |
| POST | `/api-interfaces/v1/` | 创建API接口 | ApiInterfaceCreate对象 |
| PUT | `/api-interfaces/v1/{api_id}` | 更新API接口 | api_id, ApiInterfaceUpdate对象 |
| DELETE | `/api-interfaces/v1/{api_id}` | 删除API接口 | api_id |
| POST | `/api-interfaces/v1/search` | 搜索API接口 | ApiInterfaceQueryRequest对象 |
| GET | `/api-interfaces/v1/search/simple` | 简单搜索API接口 | keyword?, system_id?, module_id?, method?, status?, page?, size? |

#### 系统和模块管理
| 方法 | 路径 | 功能 | 参数 |
|------|------|------|------|
| GET | `/api-interfaces/v1/system/{system_id}` | 获取系统的API接口 | system_id |
| GET | `/api-interfaces/v1/module/{module_id}` | 获取模块的API接口 | module_id |

#### 批量操作
| 方法 | 路径 | 功能 | 参数 |
|------|------|------|------|
| POST | `/api-interfaces/v1/batch/status` | 批量更新状态 | ApiInterfaceBatchRequest对象 |
| POST | `/api-interfaces/v1/batch/delete` | 批量删除API接口 | api_ids (List[int]) |

#### 数据导入导出
| 方法 | 路径 | 功能 | 参数 |
|------|------|------|------|
| GET | `/api-interfaces/v1/export/data` | 导出API接口数据 | system_id?, status? |
| POST | `/api-interfaces/v1/import/data` | 导入API接口数据 | apis_data (List[ApiInterfaceCreate]) |

#### 统计和配置
| 方法 | 路径 | 功能 | 参数 |
|------|------|------|------|
| GET | `/api-interfaces/v1/stats/summary` | 获取API接口统计 | 无 |
| GET | `/api-interfaces/v1/methods/list` | 获取HTTP方法列表 | 无 |
| GET | `/api-interfaces/v1/statuses/list` | 获取状态列表 | 无 |

#### 测试与调试
| 方法 | 路径 | 功能 | 参数 |
|------|------|------|------|
| POST | `/api-interfaces/v1/test` | 测试已保存的API | api_id, TestRequest对象 |
 

### 数据模型

#### ApiInterfaceCreate
```typescript
interface ApiInterfaceCreate {
  name: string              // API名称
  description?: string      // API描述
  url: string              // API路径
  method: string           // HTTP方法
  system_id: number        // 所属系统ID
  module_id?: number       // 所属模块ID
  enabled: boolean         // 是否启用
  tags?: string[]          // 标签列表
  headers?: object         // 请求头
  params?: object          // 请求参数
  body?: object            // 请求体
  response_example?: object // 响应示例
}
```

> 说明：当在前端使用“解析GET参数”生成参数表后，保存时会将参数转换为 `request_schema` 的JSON结构并随创建/更新请求提交；`url` 字段仅保存路径部分（不含查询串）。

#### ApiInterfaceUpdate
```typescript
interface ApiInterfaceUpdate {
  name?: string
  description?: string
  url?: string
  method?: string
  enabled?: boolean
  tags?: string[]
  headers?: object
  params?: object
  body?: object
  response_example?: object
}
```

#### ApiInterfaceQueryRequest
```typescript
interface ApiInterfaceQueryRequest {
  system_id?: number       // 系统ID筛选
  module_id?: number       // 模块ID筛选
  keyword?: string         // 搜索关键词
  method?: string          // HTTP方法筛选
  status?: string          // 状态筛选
  enabled_only?: boolean   // 仅显示启用的
  page?: number           // 页码
  size?: number           // 每页数量
}
```

## 常见问题与解决方案

### API编辑保存状态管理问题

#### 问题描述
在API编辑表单中，点击保存按钮后，保存状态（loading）一直显示，无法重置，导致用户无法进行后续操作。

#### 根本原因
前端`ApiFormDialog`组件的保存状态管理存在缺陷：
- 子组件`ApiFormDialog`触发保存事件后，`saving`状态设置为`true`
- 父组件`api-management/index.vue`处理保存逻辑，但未通知子组件重置状态
- 导致无论保存成功或失败，`saving`状态都无法重置为`false`

#### 解决方案
1. **修改子组件** (`ApiFormDialog.vue`)：
   ```javascript
   // 添加重置保存状态的方法
   const resetSavingState = () => {
     saving.value = false
   }
   
   // 使用 defineExpose 暴露方法给父组件
   defineExpose({
     resetSavingState
   })
   ```

2. **修改父组件** (`api-management/index.vue`)：
   ```javascript
   // 添加子组件引用
   const apiFormDialogRef = ref()
   
   // 在 saveApi 方法中调用子组件的重置方法
   const saveApi = async (formData) => {
     try {
       // ... 保存逻辑
       // 保存成功后重置状态
       apiFormDialogRef.value.resetSavingState()
     } catch (error) {
       // 保存失败后也要重置状态
       apiFormDialogRef.value.resetSavingState()
     }
   }
   ```

#### 修复效果
- 保存成功或失败后，loading状态都能正确重置
- 用户可以正常进行多次编辑保存操作
- 提升了用户体验和界面响应性

### 其他常见问题

#### 表单验证问题
- **问题**: 表单提交时验证不通过但没有明确提示
- **解决**: 确保所有验证规则都有对应的错误提示信息

#### 网络请求超时
- **问题**: API请求超时导致页面卡死
- **解决**: 设置合理的请求超时时间和重试机制

## 最佳实践

### 操作建议
1. **合理分类**: 为API设置清晰的分类和标签
2. **详细描述**: 提供完整的API描述和文档
3. **定期维护**: 及时更新API状态和信息
4. **测试验证**: 定期测试API的可用性

### 数据管理
1. **备份导出**: 定期导出API数据备份
2. **版本控制**: 记录API的变更历史
3. **权限管理**: 合理设置API的访问权限
4. **监控告警**: 设置API状态监控

### 团队协作
1. **命名规范**: 统一API命名和路径规范
2. **文档标准**: 建立API文档编写标准
3. **审核流程**: 建立API创建和修改审核机制
4. **知识共享**: 定期分享API使用经验

### 状态管理最佳实践
1. **父子组件通信**: 使用`defineExpose`暴露子组件方法给父组件调用
2. **状态重置**: 确保异步操作完成后及时重置loading状态
3. **错误处理**: 在catch块中也要处理状态重置
4. **用户反馈**: 提供明确的操作成功/失败反馈

## 🛠️ 技术实现

### 核心技术栈
```
前端技术栈:
├─ 框架: Vue 3.x + TypeScript
├─ 构建工具: Vite 4.x
├─ UI组件库: Ant Design Vue 4.x
├─ 状态管理: Pinia
├─ 路由管理: Vue Router 4.x
├─ HTTP客户端: Axios
├─ 代码规范: ESLint + Prettier
└─ 类型检查: TypeScript 5.x
```

### 组件架构设计
```
API管理模块组件结构:
├─ api-management/
│   ├─ index.vue (主页面容器)
│   ├─ components/
│   │   ├─ ApiList.vue (API列表组件)
│   │   ├─ ApiFormDialog.vue (API表单对话框)
│   │   ├─ ApiSearchFilter.vue (搜索筛选组件)
│   │   ├─ ApiTestDialog.vue (API测试对话框)
│   │   └─ ApiImportDialog.vue (API导入对话框)
│   ├─ composables/
│   │   ├─ useApiList.ts (API列表逻辑)
│   │   ├─ useApiForm.ts (API表单逻辑)
│   │   └─ useApiSearch.ts (搜索筛选逻辑)
│   └─ types/
│       ├─ api.ts (API相关类型定义)
│       └─ form.ts (表单相关类型定义)
```

### 状态管理设计
```typescript
// stores/api.ts - API状态管理
interface ApiState {
  // API列表数据
  apiList: ApiItem[]
  // 当前选中的API
  selectedApi: ApiItem | null
  // 搜索筛选条件
  searchFilters: SearchFilters
  // 加载状态
  loading: {
    list: boolean
    detail: boolean
    saving: boolean
  }
  // 分页信息
  pagination: {
    current: number
    pageSize: number
    total: number
  }
}

// 核心Action方法
const apiStore = defineStore('api', {
  state: (): ApiState => ({...}),
  actions: {
    // 获取API列表
    async fetchApiList(params?: SearchParams): Promise<void>
    // 创建API
    async createApi(data: CreateApiRequest): Promise<void>
    // 更新API
    async updateApi(id: string, data: UpdateApiRequest): Promise<void>
    // 删除API
    async deleteApi(id: string): Promise<void>
    // 批量操作
    async batchOperation(ids: string[], operation: BatchOperation): Promise<void>
  }
})
```

### 数据流设计
```
数据流向图:
┌─────────────────────────────────────────────────────────────┐
│                      API管理数据流                          │
├─────────────────────────────────────────────────────────────┤
│ 用户操作 → 组件事件 → Composable逻辑 → Pinia Store → API请求 │
│    ↓         ↓           ↓            ↓          ↓        │
│ 点击按钮   emit事件   业务逻辑处理   状态更新   后端接口     │
│    ↓                                   ↓          ↓        │
│ 界面反馈 ← 组件更新 ← 响应式更新 ← 状态变更 ← 响应数据      │
└─────────────────────────────────────────────────────────────┘
```

### 性能优化策略
- **虚拟滚动**: 使用`vue-virtual-scroller`处理大量API数据
- **防抖搜索**: 搜索输入使用300ms防抖，减少API调用
- **缓存策略**: 使用Pinia持久化插件缓存常用数据
- **懒加载**: 非关键组件使用动态导入
- **代码分割**: 按路由和功能模块分割代码包

### 错误处理机制
```typescript
// 统一错误处理
class ApiErrorHandler {
  // 网络错误处理
  static handleNetworkError(error: AxiosError): void {
    if (error.code === 'NETWORK_ERROR') {
      message.error('网络连接失败，请检查网络设置')
    } else if (error.code === 'TIMEOUT') {
      message.error('请求超时，请稍后重试')
    }
  }
  
  // 业务错误处理
  static handleBusinessError(error: BusinessError): void {
    switch (error.code) {
      case 'API_NOT_FOUND':
        message.error('API不存在或已被删除')
        break
      case 'PERMISSION_DENIED':
        message.error('权限不足，无法执行此操作')
        break
      default:
        message.error(error.message || '操作失败')
    }
  }
}
```

### 数据同步策略
- **实时更新**: 使用WebSocket接收API状态变更通知
- **离线缓存**: 使用IndexedDB缓存关键数据，支持离线查看
- **智能预加载**: 根据用户行为预加载可能需要的数据
- **增量同步**: 只同步变更的数据，减少网络传输

## 技术实现详情

### 核心技术栈
- **Vue 3.x**: 组合式API，响应式系统
- **TypeScript**: 类型安全，智能提示
- **Vite**: 快速构建，热更新
- **Ant Design Vue**: UI组件库
- **Pinia**: 状态管理
- **Vue Router**: 路由管理
- **VueUse**: 组合式工具库
- **Axios**: HTTP客户端
- **Monaco Editor**: 代码编辑器

### 组件架构设计

#### ApiManagement 主组件
```typescript
interface ApiManagementState {
  apis: ApiInfo[]
  selectedApi: ApiInfo | null
  loading: boolean
  filters: ApiFilters
  pagination: PaginationConfig
  testResult: ApiTestResult | null
}

interface ApiManagementProps {
  systemId?: string
  moduleId?: string
  showHeader?: boolean
  enableBatchOperations?: boolean
}

interface ApiManagementEvents {
  'api-selected': (api: ApiInfo) => void
  'api-created': (api: ApiInfo) => void
  'api-updated': (api: ApiInfo) => void
  'api-deleted': (apiId: string) => void
  'api-tested': (result: ApiTestResult) => void
}
```

#### ApiList 组件
```typescript
interface ApiListState {
  apis: ApiInfo[]
  selectedKeys: string[]
  loading: boolean
  sortConfig: SortConfig
}

interface ApiListProps {
  apis: ApiInfo[]
  loading?: boolean
  selectable?: boolean
  sortable?: boolean
  showActions?: boolean
}

interface ApiListEvents {
  'item-click': (api: ApiInfo) => void
  'item-select': (keys: string[]) => void
  'sort-change': (config: SortConfig) => void
  'action-click': (action: string, api: ApiInfo) => void
}
```

#### ApiEditor 组件
```typescript
interface ApiEditorState {
  form: ApiFormData
  loading: boolean
  errors: Record<string, string>
  activeTab: string
}

interface ApiEditorProps {
  mode: 'create' | 'edit'
  initialData?: Partial<ApiFormData>
  systemId?: string
  moduleId?: string
}

interface ApiEditorEvents {
  'save': (data: ApiFormData) => void
  'cancel': () => void
  'test': (data: ApiFormData) => void
}
```

#### ApiTester 组件
```typescript
interface ApiTesterState {
  request: ApiRequest
  response: ApiResponse | null
  loading: boolean
  history: ApiTestHistory[]
}

interface ApiTesterProps {
  api: ApiInfo
  defaultRequest?: Partial<ApiRequest>
}

interface ApiTesterEvents {
  'test-start': (request: ApiRequest) => void
  'test-complete': (response: ApiResponse) => void
  'test-error': (error: Error) => void
}
```

### 状态管理设计

#### ApiManagementState
```typescript
interface ApiManagementState {
  // API数据
  apis: ApiInfo[]
  apiTree: ApiTreeNode[]
  selectedApi: ApiInfo | null
  
  // 筛选和搜索
  filters: {
    systemId: string | null
    moduleId: string | null
    method: HttpMethod | 'all'
    status: ApiStatus | 'all'
    searchKeyword: string
    tags: string[]
  }
  
  // 分页
  pagination: {
    current: number
    pageSize: number
    total: number
  }
  
  // 加载状态
  loading: {
    list: boolean
    details: boolean
    test: boolean
    operation: boolean
  }
  
  // 编辑器状态
  editor: {
    visible: boolean
    mode: 'create' | 'edit'
    data: ApiFormData | null
  }
  
  // 测试器状态
  tester: {
    visible: boolean
    api: ApiInfo | null
    result: ApiTestResult | null
  }
  
  // 批量操作
  batchSelection: {
    selectedKeys: string[]
    selectedApis: ApiInfo[]
  }
}
```

#### ApiManagementActions
```typescript
interface ApiManagementActions {
  // 数据获取
  fetchApis: (params?: ApiQueryParams) => Promise<void>
  fetchApiDetails: (id: string) => Promise<ApiInfo>
  fetchApiTree: (systemId?: string) => Promise<void>
  
  // CRUD操作
  createApi: (data: ApiCreateData) => Promise<ApiInfo>
  updateApi: (id: string, data: ApiUpdateData) => Promise<ApiInfo>
  deleteApi: (id: string) => Promise<void>
  batchDeleteApis: (ids: string[]) => Promise<void>
  
  // API测试
  testApi: (api: ApiInfo, request: ApiRequest) => Promise<ApiResponse>
  saveTestCase: (testCase: ApiTestCase) => Promise<void>
  getTestHistory: (apiId: string) => Promise<ApiTestHistory[]>
  
  // 导入导出
  importApis: (file: File) => Promise<ImportResult>
  exportApis: (ids: string[]) => Promise<void>
  
  // 筛选和搜索
  setFilters: (filters: Partial<ApiFilters>) => void
  setSearchKeyword: (keyword: string) => void
  resetFilters: () => void
  
  // 选择管理
  selectApi: (api: ApiInfo) => void
  selectBatchApis: (apis: ApiInfo[]) => void
  clearSelection: () => void
  
  // 编辑器管理
  openCreateEditor: (systemId?: string, moduleId?: string) => void
  openEditEditor: (api: ApiInfo) => void
  closeEditor: () => void
  
  // 测试器管理
  openTester: (api: ApiInfo) => void
  closeTester: () => void
}
```

### 数据流设计

#### API测试完整流程
```typescript
// 1. 用户点击测试按钮
const handleTestApi = async (api: ApiInfo, request: ApiRequest) => {
  try {
    // 2. 显示加载状态
    setLoading('test', true)
    
    // 3. 验证请求参数
    const validatedRequest = validateApiRequest(request)
    
    // 4. 发送测试请求
    const response = await apiService.testApi(api, validatedRequest)
    
    // 5. 保存测试历史
    await saveTestHistory({
      apiId: api.id,
      request: validatedRequest,
      response,
      timestamp: Date.now()
    })
    
    // 6. 更新测试结果
    setTestResult(response)
    
    // 7. 显示成功消息
    showSuccessMessage('API测试完成')
    
  } catch (error) {
    // 8. 错误处理
    setTestError(error)
    showErrorMessage(error.message)
  } finally {
    // 9. 隐藏加载状态
    setLoading('test', false)
  }
}
```

### 性能优化策略

#### 虚拟滚动
```typescript
// API列表虚拟滚动
const VirtualApiList = defineComponent({
  setup() {
    const { list, containerProps, wrapperProps } = useVirtualList(
      apis,
      {
        itemHeight: 120,
        overscan: 10,
      }
    )
    
    return { list, containerProps, wrapperProps }
  }
})
```

#### 防抖搜索
```typescript
// API搜索防抖
const searchKeyword = ref('')
const debouncedSearch = useDebounceFn((keyword: string) => {
  setFilters({ searchKeyword: keyword })
  fetchApis()
}, 500)

watch(searchKeyword, debouncedSearch)
```

#### 智能缓存
```typescript
// API详情缓存
const apiDetailsCache = new Map<string, ApiInfo>()
const cacheExpiry = new Map<string, number>()

const getApiDetails = async (id: string) => {
  const now = Date.now()
  const expiry = cacheExpiry.get(id)
  
  if (apiDetailsCache.has(id) && expiry && now < expiry) {
    return apiDetailsCache.get(id)
  }
  
  const details = await apiService.getApiDetails(id)
  apiDetailsCache.set(id, details)
  cacheExpiry.set(id, now + 5 * 60 * 1000) // 5分钟缓存
  
  return details
}
```

#### 代码分割
```typescript
// 路由级别代码分割
const ApiManagement = defineAsyncComponent(
  () => import('@/views/api-management/index.vue')
)

const ApiEditor = defineAsyncComponent(
  () => import('@/components/api-editor/index.vue')
)

const ApiTester = defineAsyncComponent(
  () => import('@/components/api-tester/index.vue')
)
```

### 错误处理机制

#### API测试错误处理
```typescript
const handleApiTestError = (error: ApiTestError) => {
  switch (error.type) {
    case 'NETWORK_ERROR':
      showErrorMessage('网络连接失败，请检查网络设置')
      break
    case 'TIMEOUT_ERROR':
      showErrorMessage('请求超时，请稍后重试')
      break
    case 'VALIDATION_ERROR':
      showValidationErrors(error.details)
      break
    case 'SERVER_ERROR':
      showErrorMessage(`服务器错误: ${error.message}`)
      break
    default:
      showErrorMessage('未知错误，请联系管理员')
  }
}
```

#### 批量操作错误处理
```typescript
const handleBatchOperationError = (results: BatchOperationResult[]) => {
  const failed = results.filter(r => !r.success)
  
  if (failed.length === 0) {
    showSuccessMessage('批量操作完成')
  } else if (failed.length === results.length) {
    showErrorMessage('批量操作失败')
  } else {
    showWarningMessage(`部分操作失败: ${failed.length}/${results.length}`)
    showFailedItems(failed)
  }
}
```

### 数据同步策略

#### 实时同步
```typescript
// WebSocket实时数据同步
const useApiSync = () => {
  const { connect, disconnect, on } = useWebSocket('/api/ws/apis')
  
  on('api:created', (api: ApiInfo) => {
    addApiToList(api)
    updateApiTree()
  })
  
  on('api:updated', (api: ApiInfo) => {
    updateApiInList(api)
    invalidateCache(api.id)
  })
  
  on('api:deleted', (apiId: string) => {
    removeApiFromList(apiId)
    clearCache(apiId)
  })
  
  on('api:tested', (result: ApiTestResult) => {
    updateTestResult(result)
  })
  
  return { connect, disconnect }
}
```

#### 离线缓存
```typescript
// IndexedDB离线缓存
const useApiCache = () => {
  const db = useIndexedDB('apis', 1)
  
  const cacheApi = async (api: ApiInfo) => {
    await db.put('apis', api)
  }
  
  const getCachedApis = async (filters: ApiFilters) => {
    const allApis = await db.getAll('apis')
    return filterApis(allApis, filters)
  }
  
  const syncWithServer = async () => {
    const lastSync = await db.get('metadata', 'lastSync')
    const changes = await apiService.getChanges(lastSync)
    
    for (const change of changes) {
      switch (change.type) {
        case 'create':
        case 'update':
          await db.put('apis', change.data)
          break
        case 'delete':
          await db.delete('apis', change.id)
          break
      }
    }
    
    await db.put('metadata', Date.now(), 'lastSync')
  }
  
  return { cacheApi, getCachedApis, syncWithServer }
}
```

## ✅ 文档质量检查

### 内容完整性检查
- [ ] **文档信息**: 包含文档编号、版本、更新时间、负责人
- [ ] **模块概述**: 清晰描述模块功能、定位、核心价值
- [ ] **使用场景**: 详细说明不同用户角色的使用场景
- [ ] **界面布局**: 提供完整的ASCII图和布局说明
- [ ] **设计规范**: 包含色彩、字体、尺寸等设计标准
- [ ] **交互流程**: 详细描述用户操作流程和系统响应
- [ ] **技术实现**: 说明技术栈、架构设计、性能优化
- [ ] **最佳实践**: 提供操作建议和注意事项

### 格式规范检查
- [ ] **标题层级**: 使用正确的Markdown标题层级（#、##、###）
- [ ] **代码块**: 使用正确的语法高亮标记（```typescript、```javascript）
- [ ] **ASCII图**: 使用等宽字符，保持对齐和美观
- [ ] **列表格式**: 统一使用`-`或`1.`格式，保持缩进一致
- [ ] **链接引用**: 内部链接使用相对路径，外部链接使用完整URL
- [ ] **表格格式**: 使用标准Markdown表格语法，保持对齐

### 技术准确性检查
- [ ] **代码示例**: 确保代码示例语法正确，可以运行
- [ ] **API接口**: 验证API路径、参数、响应格式的准确性
- [ ] **组件引用**: 确保组件名称、属性、方法名称正确
- [ ] **技术栈**: 验证框架版本、依赖包版本的准确性
- [ ] **配置信息**: 检查配置文件、环境变量的正确性

### 用户体验检查
- [ ] **语言表达**: 使用简洁明了的语言，避免技术术语过多
- [ ] **逻辑顺序**: 按照用户使用流程组织内容结构
- [ ] **视觉效果**: ASCII图清晰易懂，代码块格式美观
- [ ] **导航便利**: 提供目录索引，支持快速定位
- [ ] **实用性**: 内容对实际开发工作有指导价值

### 维护更新检查
- [ ] **版本同步**: 文档版本与代码版本保持同步
- [ ] **链接有效**: 检查所有内部外部链接的有效性
- [ ] **截图更新**: 界面截图与当前版本界面一致
- [ ] **功能同步**: 文档功能描述与实际功能一致
- [ ] **反馈收集**: 建立文档反馈机制，持续改进

### 质量评分标准
```
文档质量评分 (总分100分):
├─ 内容完整性 (30分): 信息齐全，覆盖全面
├─ 格式规范性 (20分): 格式统一，排版美观
├─ 技术准确性 (25分): 技术内容准确无误
├─ 用户体验 (15分): 易读易懂，逻辑清晰
└─ 维护及时性 (10分): 更新及时，版本同步

评分等级:
├─ 优秀 (90-100分): 可作为标准模板
├─ 良好 (80-89分): 基本达标，少量优化
├─ 合格 (70-79分): 满足基本要求
└─ 需改进 (<70分): 需要重大修改
```

---

**文档维护**: 本文档由前端开发团队维护，如有问题请联系 @frontend-team  
**最后更新**: 2024-01-15  
**下次审查**: 2024-02-15
